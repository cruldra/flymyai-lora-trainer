import marimo

__generated_with = "0.16.2"
app = marimo.App(width="medium")


@app.cell
def _():
    import marimo as mo
    return (mo,)


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    # å®Œæ•´çš„MLOpsè“å›¾ï¼šMLç³»ç»Ÿä¸­çš„å¯é‡ç°æ€§å’Œç‰ˆæœ¬æ§åˆ¶â€”ç¬¬Aéƒ¨åˆ†ï¼ˆå«å®ç°ï¼‰

    ## å›é¡¾

    åœ¨æ·±å…¥MLOpså’ŒLLMOpsé€Ÿæˆè¯¾ç¨‹çš„ç¬¬3éƒ¨åˆ†ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç®€è¦å›é¡¾ä¸€ä¸‹åœ¨è¯¾ç¨‹çš„å‰ä¸€éƒ¨åˆ†ä¸­æ¶µç›–çš„å†…å®¹ã€‚

    åœ¨ç¬¬2éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥ç ”ç©¶äº†MLç³»ç»Ÿç”Ÿå‘½å‘¨æœŸï¼Œå°†ä¸åŒé˜¶æ®µåˆ†è§£ä¸ºè¯¦ç»†è§£é‡Šã€‚

    ![MLç³»ç»Ÿç”Ÿå‘½å‘¨æœŸ](https://www.dailydoseofds.com/content/images/2025/08/image-27.png)

    æˆ‘ä»¬é¦–å…ˆäº†è§£äº†MLç³»ç»Ÿç”Ÿå‘½å‘¨æœŸçš„ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®ç®¡é“ã€‚å®ƒæ¶‰åŠæ‘„å–ã€å­˜å‚¨ã€ETLã€æ ‡æ³¨/æ³¨é‡Šå’Œæ•°æ®ç‰ˆæœ¬æ§åˆ¶ç­‰å…³é”®æ¦‚å¿µã€‚

    ![æ•°æ®ç®¡é“](https://www.dailydoseofds.com/content/images/2025/08/image-28.png)

    æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŸ¥çœ‹äº†æ¨¡å‹è®­ç»ƒå’Œå®éªŒé˜¶æ®µï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬è®¨è®ºäº†ä¸å®éªŒè·Ÿè¸ªã€æ¨¡å‹é€‰æ‹©ã€éªŒè¯ã€è®­ç»ƒç®¡é“ã€èµ„æºç®¡ç†å’Œè¶…å‚æ•°é…ç½®ç›¸å…³çš„å…³é”®æƒ³æ³•ã€‚

    ![æ¨¡å‹è®­ç»ƒå’Œå®éªŒ](https://www.dailydoseofds.com/content/images/2025/08/image-29.png)

    è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬æ¢ç´¢äº†éƒ¨ç½²å’Œæ¨ç†é˜¶æ®µã€‚æˆ‘ä»¬é€šè¿‡ç†è§£æ¨¡å‹æ‰“åŒ…ã€æ¨ç†å’Œéƒ¨ç½²æ–¹æ³•ã€æµ‹è¯•ã€æ¨¡å‹æ³¨å†Œè¡¨å’ŒCI/CDç­‰å†…å®¹æ·±å…¥ç ”ç©¶ã€‚

    ![éƒ¨ç½²å’Œæ¨ç†](https://www.dailydoseofds.com/content/images/2025/08/image-30.png)

    åœ¨éƒ¨ç½²å’Œæ¨ç†ä¹‹åï¼Œæˆ‘ä»¬ç»§ç»­äº†è§£ç›‘æ§å’Œå¯è§‚å¯Ÿæ€§ã€‚åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬æŸ¥çœ‹äº†è¿è¥ç›‘æ§ã€æ¼‚ç§»å’Œæ€§èƒ½ç›‘æ§ã€‚

    ![ç›‘æ§å’Œå¯è§‚å¯Ÿæ€§](https://www.dailydoseofds.com/content/images/2025/08/image-31.png)

    æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå¿«é€Ÿçš„å®è·µæ¨¡æ‹Ÿï¼Œç ”ç©¶äº†å¦‚ä½•åºåˆ—åŒ–æ¨¡å‹ã€å°†å®ƒä»¬è½¬æ¢ä¸ºFastAPIæœåŠ¡ã€æµ‹è¯•å®ƒä»¬ï¼Œå¹¶ä¸ºå¯é‡ç°æ€§å’Œéƒ¨ç½²è€ƒè™‘è¿›è¡Œå®¹å™¨åŒ–ã€‚

    ![å®è·µæ¨¡æ‹Ÿ](https://www.dailydoseofds.com/content/images/2025/08/image-32.png)

    å¦‚æœä½ è¿˜æ²¡æœ‰å­¦ä¹ ç¬¬2éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®å…ˆå¤ä¹ å®ƒï¼Œå› ä¸ºå®ƒå»ºç«‹äº†ç†è§£æˆ‘ä»¬å³å°†æ¶µç›–çš„ææ–™æ‰€å¿…éœ€çš„æ¦‚å¿µåŸºç¡€ã€‚

    ä½ å¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°å®ƒï¼š

    [The Full MLOps Blueprint: The Machine Learning System Lifecycle](https://www.dailydoseofds.com/mlops-crash-course-part-2/)

    åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢MLç³»ç»Ÿçš„å¯é‡ç°æ€§å’Œç‰ˆæœ¬æ§åˆ¶ï¼Œé‡ç‚¹å…³æ³¨å…³é”®ç†è®ºç»†èŠ‚å’Œå®è·µå®ç°ï¼ˆåœ¨éœ€è¦æ—¶ï¼‰ã€‚

    ä¸€å¦‚æ—¢å¾€ï¼Œæ¯ä¸ªæ¦‚å¿µéƒ½å°†é€šè¿‡æ¸…æ™°çš„ç¤ºä¾‹å’Œæ¼”ç»ƒæ¥è§£é‡Šï¼Œä»¥åŸ¹å…»æ¸…æ™°çš„ç†è§£ã€‚

    è®©æˆ‘ä»¬å¼€å§‹å§ï¼

    ---
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## å¼•è¨€

    æˆ‘ä»¬åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­éƒ½æ¶‰åŠåˆ°çš„ä¸€ä¸ªä¸»é¢˜ï¼Œä½†å€¼å¾—é‡ç‚¹å…³æ³¨çš„æ˜¯å¯é‡ç°æ€§ã€‚

    é¡¾åæ€ä¹‰ï¼Œå¯é‡ç°æ€§æ„å‘³ç€ä½ å¯ä»¥é‡å¤ä¸€ä¸ªå®éªŒæˆ–è¿‡ç¨‹å¹¶è·å¾—ç›¸åŒçš„ç»“æœã€‚åœ¨MLä¸­ï¼Œè¿™å¯¹ä¿¡ä»»å’Œåä½œè‡³å…³é‡è¦ã€‚

    ![å¯é‡ç°æ€§é‡è¦æ€§](https://www.dailydoseofds.com/content/images/2025/08/image-48.png)

    å¦‚æœå…¶ä»–äººï¼ˆæˆ–æœªæ¥çš„ä½ ï¼‰æ— æ³•é‡ç°ä½ çš„æ¨¡å‹è®­ç»ƒï¼Œå°±å¾ˆéš¾è°ƒè¯•é—®é¢˜æˆ–æ”¹è¿›å®ƒã€‚

    ![è°ƒè¯•å›°éš¾](https://www.dailydoseofds.com/content/images/2025/08/image-45.png)

    å¯é‡ç°æ€§ä¹Ÿä¸ç‰ˆæœ¬æ§åˆ¶å¯†åˆ‡ç›¸å…³ï¼Œå› ä¸ºè¦é‡ç°å®éªŒï¼Œä½ éœ€è¦ç¡®åˆ‡çŸ¥é“ä½¿ç”¨äº†å“ªäº›ä»£ç ã€æ•°æ®å’Œå‚æ•°ã€‚

    è®©æˆ‘ä»¬åˆ†è§£ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦ä»¥åŠå¦‚ä½•åœ¨ç”Ÿäº§MLç³»ç»Ÿä¸­å®ç°å®ƒã€‚

    ---
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## ä¸ºä»€ä¹ˆå¯é‡ç°æ€§å¾ˆé‡è¦

    é€šè¿‡æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢å­¦åˆ°çš„å†…å®¹ï¼Œæˆ‘ä»¬å¾ˆå¥½åœ°ç†è§£äº†å¯é‡ç°æ€§å¯¹ç”Ÿäº§çº§ç³»ç»Ÿç›¸å½“å…³é”®çš„äº‹å®ã€‚

    æ‰€ä»¥è®©æˆ‘ä»¬æ‰©å±•æˆ‘ä»¬çš„ç†è§£ï¼Œçœ‹çœ‹ä½¿å¯é‡ç°æ€§å’Œç‰ˆæœ¬æ§åˆ¶å¦‚æ­¤é‡è¦çš„å…³é”®å› ç´ ã€‚

    ### è°ƒè¯•å’Œé”™è¯¯è·Ÿè¸ª

    å¦‚æœæ¨¡å‹çš„æ€§èƒ½çªç„¶ä¸‹é™ï¼Œæˆ–è€…ç¦»çº¿å’Œåœ¨çº¿è¡Œä¸ºä¹‹é—´å­˜åœ¨å·®å¼‚ï¼Œèƒ½å¤Ÿå®Œå…¨æŒ‰ç…§åŸæ ·é‡ç°è®­ç»ƒè¿‡ç¨‹å¯ä»¥å¸®åŠ©æŸ¥æ˜åŸå› ã€‚

    ä¾‹å¦‚ï¼Œæ˜¯ä»£ç æ›´æ”¹å—ï¼Ÿåº“çš„æ–°ç‰ˆæœ¬ï¼Ÿä¸åŒçš„éšæœºç§å­ï¼Ÿæ²¡æœ‰å¯é‡ç°æ€§ï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨è¿½é€ä¸€ä¸ªç§»åŠ¨çš„ç›®æ ‡ã€‚

    ![è°ƒè¯•æŒ‘æˆ˜](https://www.dailydoseofds.com/content/images/2025/08/image-47.png)

    ### åä½œ

    åœ¨å›¢é˜Ÿä¸­ï¼Œä¸€ä¸ªå·¥ç¨‹å¸ˆå¯èƒ½æƒ³è¦é‡æ–°è¿è¡Œå¦ä¸€ä¸ªäººçš„å®éªŒæ¥éªŒè¯ç»“æœæˆ–åœ¨æ­¤åŸºç¡€ä¸Šæ„å»ºã€‚å¦‚æœå®ƒä¸å¯é‡ç°ï¼Œå°±ä¼šå‡æ…¢è¿›åº¦ã€‚

    ![åä½œé—®é¢˜](https://www.dailydoseofds.com/content/images/2025/08/image-46.png)

    ç”±äºç¼ºä¹å¯é‡ç°æ€§å¯¼è‡´çš„åä½œé—®é¢˜

    é‡ç°æŸäººçš„å·¥ä½œåº”è¯¥åƒæ‹‰å–ä»–ä»¬çš„ä»£ç å’Œæ•°æ®å¹¶è¿è¡Œè„šæœ¬ä¸€æ ·ç®€å•ï¼Œè€Œä¸æ˜¯"ä½ ä½¿ç”¨äº†ä»€ä¹ˆç¯å¢ƒï¼Ÿ"çš„çŒœè°œæ¸¸æˆã€‚

    ### æ³•è§„å’Œåˆè§„æ€§

    åœ¨æŸäº›è¡Œä¸šï¼Œå¦‚åŒ»ç–—ä¿å¥ã€é‡‘èæˆ–è‡ªåŠ¨é©¾é©¶æ±½è½¦ï¼Œä½ å¯èƒ½éœ€è¦è¯æ˜æ¨¡å‹æ˜¯å¦‚ä½•æ„å»ºçš„ï¼Œä»¥åŠå®ƒçš„è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€‚

    ä¾‹å¦‚ï¼Œé“¶è¡Œå¯èƒ½éœ€è¦å‘ç›‘ç®¡æœºæ„å±•ç¤ºå¯¼è‡´ä¿¡ç”¨é£é™©æ¨¡å‹çš„ç¡®åˆ‡è®­ç»ƒç¨‹åºï¼Œå¹¶ä¸”åœ¨ç›¸åŒæ•°æ®ä¸Šå†æ¬¡è¿è¡Œå®ƒä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœã€‚

    ğŸ‘‰

    å¦‚æœæ¨¡å‹å†³ç­–å—åˆ°è´¨ç–‘ï¼ˆæ¯”å¦‚ï¼Œæœ‰äººæŒ‡æ§å®ƒæœ‰åè§ï¼‰ï¼Œä½ éœ€è¦é‡æ–°åˆ›å»ºè¯¥å†³ç­–æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚

    ### è¿ç»­æ€§

    äººå‘˜å˜åŠ¨ä¼šå‘ç”Ÿï¼Œä¹Ÿè®¸æ¨¡å‹çš„åŸå§‹ä½œè€…ç¦»å¼€äº†å…¬å¸ã€‚

    å¦‚æœè¿‡ç¨‹æœ‰è‰¯å¥½çš„æ–‡æ¡£è®°å½•ä¸”å¯é‡ç°ï¼Œä¸‹ä¸€ä¸ªäººå¯ä»¥æ¥æ‰‹ã€‚å¦‚æœæ²¡æœ‰ï¼Œç»„ç»‡å°±æœ‰å¤±å»é”å®šåœ¨è¯¥æ¨¡å‹ä¸­çš„"çŸ¥è¯†"çš„é£é™©ã€‚
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ### ç”Ÿäº§é—®é¢˜

    æˆ‘ä»¬ç»å¸¸å®šæœŸé‡æ–°è®­ç»ƒæ¨¡å‹ã€‚å¦‚æœæ–°æ¨¡å‹ç‰ˆæœ¬æ¯”ä¸Šä¸€ä¸ªç‰ˆæœ¬è¡¨ç°æ›´å·®ï¼Œå¯é‡ç°æ€§ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ä½ å¯ä»¥æ¯”è¾ƒè¿è¡Œï¼Œå› ä¸ºä½ å·²ç»å¯¹æ‰€æœ‰æˆåˆ†è¿›è¡Œäº†ç‰ˆæœ¬æ§åˆ¶ã€‚

    ![æ¨¡å‹ç‰ˆæœ¬æ¯”è¾ƒ](https://www.dailydoseofds.com/content/images/2025/08/image-50-1.png)

    æ­¤å¤–ï¼Œå¦‚æœä½ éœ€è¦å›æ»šåˆ°ä»¥å‰çš„æ¨¡å‹ï¼Œä½ åº”è¯¥ç†æƒ³åœ°é‡æ–°è®­ç»ƒå®ƒï¼ˆå¦‚æœæ•°æ®å·²æ›´æ”¹ï¼‰æˆ–è‡³å°‘æ‹¥æœ‰ç¡®åˆ‡çš„å·¥ä»¶ã€‚ç‰ˆæœ¬æ§åˆ¶å…è®¸ä½ è¿™æ ·åšã€‚

    ![æ¨¡å‹å›æ»š](https://www.dailydoseofds.com/content/images/2025/08/image-49.png)

    ç°åœ¨æˆ‘ä»¬äº†è§£äº†å¯é‡ç°æ€§çš„é‡è¦æ€§ï¼Œè®©æˆ‘ä»¬é¦–å…ˆæ¢ç´¢ä¸ä¹‹ç›¸å…³çš„æŒ‘æˆ˜ï¼Œç„¶åæ·±å…¥äº†è§£å¦‚ä½•å°†å…¶çº³å…¥æˆ‘ä»¬çš„ç³»ç»Ÿã€‚

    ---

    ## å¯é‡ç°æ€§çš„æŒ‘æˆ˜

    ä¸çº¯è½¯ä»¶ä¸åŒï¼ŒMLçš„ç»“æœå¯èƒ½ä¾èµ–äºéšæœºæ€§ï¼ˆç¥ç»ç½‘ç»œä¸­çš„åˆå§‹æƒé‡ã€éšæœºè®­ç»ƒ-æµ‹è¯•åˆ†å‰²ç­‰ï¼‰ã€‚å¦‚æœä¸åŠ ä»¥æ§åˆ¶ï¼Œä½¿ç”¨ç›¸åŒä»£ç /æ•°æ®çš„ä¸¤æ¬¡è¿è¡Œä»å¯èƒ½äº§ç”Ÿç•¥æœ‰ä¸åŒçš„æ¨¡å‹ã€‚

    æ­£å¦‚æˆ‘ä»¬åœ¨ç¬¬1éƒ¨åˆ†ä¸­çœ‹åˆ°çš„ï¼ŒMLæ˜¯"éƒ¨åˆ†ä»£ç ï¼Œéƒ¨åˆ†æ•°æ®"ã€‚ä½ éœ€è¦å¯¹ä¸¤è€…è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚

    ![ä»£ç å’Œæ•°æ®ç‰ˆæœ¬æ§åˆ¶](https://www.dailydoseofds.com/content/images/2025/08/image-51.png)

    æ•°æ®å¾ˆå¤§ï¼Œæ‰€ä»¥ä½ ä¸èƒ½è½»æ˜“åœ°å°†æ•°æ®é›†æ”¾å…¥Gitï¼ˆå¦å¤–ï¼Œæ•°æ®å¯èƒ½éšæ—¶é—´æ›´æ–°ï¼‰ã€‚

    ![æ•°æ®ç‰ˆæœ¬æ§åˆ¶æŒ‘æˆ˜](https://www.dailydoseofds.com/content/images/2025/08/image-52.png)

    ç¯å¢ƒå¾ˆé‡è¦â€”â€”åº“ç‰ˆæœ¬ã€ç¡¬ä»¶ï¼ˆå¾ˆå°‘ï¼Œä¸åŒGPUä¸Šçš„æµ®ç‚¹ç²¾åº¦ç­‰å·®å¼‚å¯èƒ½å¯¼è‡´å·®å¼‚ï¼‰ã€æ“ä½œç³»ç»Ÿç­‰ã€‚å¦‚æœä½ çš„è®­ç»ƒä»£ç ä¾èµ–äºæŸäº›ç³»ç»Ÿç‰¹å®šè¡Œä¸ºï¼Œé‚£å°±æ˜¯å¯é‡ç°æ€§é£é™©ã€‚

    MLæ¨¡å‹å’Œç®¡é“æœ‰å¾ˆå¤šç§»åŠ¨éƒ¨ä»¶ï¼Œå¦‚æ¨¡å‹è¶…å‚æ•°ã€ç‰¹å¾ç®¡é“ã€é¢„å¤„ç†æ­¥éª¤ç­‰ã€‚

    å¾ˆå®¹æ˜“æœ‰æ²¡æœ‰å®Œå…¨è·Ÿè¸ªçš„"å®éªŒ"ã€‚ä¾‹å¦‚ï¼Œä½ åœ¨ç¬”è®°æœ¬ä¸­æ‰‹åŠ¨è°ƒæ•´äº†æŸäº›å†…å®¹å¹¶å¿˜è®°äº†ï¼Œå¯¼è‡´ä¸€ä¸ªéš¾ä»¥å¤åˆ¶çš„ä¸€æ¬¡æ€§æ¨¡å‹ã€‚

    ![å®éªŒè·Ÿè¸ªæŒ‘æˆ˜](https://www.dailydoseofds.com/content/images/2025/08/image-53-1.png)

    æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›æœ€ä½³å®è·µï¼Œè¿™äº›å®è·µå¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™äº›æŒ‘æˆ˜ï¼Œå¹¶äº†è§£å¦‚ä½•æœ‰æ•ˆåœ°å°†å¯é‡ç°æ€§å’Œç‰ˆæœ¬æ§åˆ¶çº³å…¥MLç³»ç»Ÿã€‚

    ---
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## å¯é‡ç°æ€§å’Œç‰ˆæœ¬æ§åˆ¶çš„æœ€ä½³å®è·µ

    ç°åœ¨æˆ‘ä»¬å¯¹å¯é‡ç°æ€§çš„é‡è¦æ€§å’Œå®ƒå¸¦æ¥çš„æŒ‘æˆ˜æœ‰äº†æ‰å®çš„ç†è§£ï¼Œè®©æˆ‘ä»¬æ¢ç´¢å¸®åŠ©æˆ‘ä»¬å……åˆ†åˆ©ç”¨å¯é‡ç°æ€§å’Œç‰ˆæœ¬æ§åˆ¶å¥½å¤„çš„æœ€ä½³å®è·µã€‚

    ### ç¡®ä¿ç¡®å®šæ€§è¿‡ç¨‹

    å¦‚æœéœ€è¦ç²¾ç¡®çš„å¯é‡ç°æ€§ï¼Œåœ¨è®­ç»ƒä»£ç ä¸­è®¾ç½®éšæœºç§å­ã€‚å¤§å¤šæ•°MLåº“éƒ½å…è®¸è¿™æ ·åšï¼ˆä¾‹å¦‚ï¼Œ`np.random.seed(0)`ã€`random.seed(0)`ï¼Œå¯¹äºTensorFlow/PyTorchç­‰æ¡†æ¶ï¼Œæœ‰æ–¹æ³•ä¸ºå®ƒä»¬çš„éšæœºæ“ä½œå›ºå®šç§å­ï¼‰ã€‚

    ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œç”±äºç«äº‰æ¡ä»¶æˆ–ç²¾åº¦é™ä½ï¼ŒæŸäº›å¹¶è¡Œæˆ–GPUæ“ä½œæœ¬è´¨ä¸Šæ˜¯éç¡®å®šæ€§çš„ã€‚å¦‚æœä½ éœ€è¦ä½å¯¹ä½ç›¸åŒçš„ç»“æœï¼Œä½ å¯èƒ½å¿…é¡»ç‰ºç‰²ä¸€äº›æ€§èƒ½ï¼ˆè®¸å¤šæ¡†æ¶éƒ½æœ‰"ç¡®å®šæ€§"æ¨¡å¼ï¼Œä½†ç¨å¾®æ…¢ä¸€äº›ï¼‰ã€‚

    åœ¨å®è·µä¸­ï¼Œå®¹å·®å†…çš„å¯é‡ç°æ€§é€šå¸¸å°±è¶³å¤Ÿäº†ï¼Œå³æ¨¡å‹å¯èƒ½ä¸æ˜¯ä½ç›¸åŒçš„ï¼Œä½†åº”è¯¥æœ‰ç±»ä¼¼çš„æ€§èƒ½å’Œç±»ä¼¼çš„è¾“å‡ºã€‚å°½ç®¡å¦‚æ­¤ï¼Œæ§åˆ¶éšæœºæ€§æ¥æºï¼ˆæ•°æ®æ´—ç‰Œé¡ºåºã€æƒé‡åˆå§‹åŒ–ç­‰ï¼‰æ˜¯è‰¯å¥½çš„å®è·µã€‚

    æ­¤å¤–ï¼Œå¦‚æœä½¿ç”¨å¤šçº¿ç¨‹ï¼Œè¯·æ³¨æ„æ‰§è¡Œé¡ºåºå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚é€šå¸¸ï¼Œå›ºå®šç§å­å¹¶ä¸ºå…³é”®éƒ¨åˆ†ä½¿ç”¨å•çº¿ç¨‹å¯ä»¥æ”¹å–„ç¡®å®šæ€§ã€‚

    ç»éªŒæ³•åˆ™ï¼šå¦‚æœæœ‰äººåœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œä½ çš„è®­ç»ƒç®¡é“ä¸¤æ¬¡ï¼Œå®ƒåº”è¯¥äº§ç”Ÿæœ‰æ•ˆç›¸åŒçš„æ¨¡å‹ï¼ˆæˆ–æŒ‡æ ‡ï¼‰ã€‚å¦‚æœæ²¡æœ‰ï¼Œè®°å½•è¿™ä¸€ç‚¹ï¼ˆä¹Ÿè®¸æ˜¯ç”±äºéç¡®å®šæ€§ï¼‰ï¼Œè‡³å°‘ç¡®ä¿æŒ‡æ ‡ç›¸åŒã€‚

    ### ä»£ç çš„ç‰ˆæœ¬æ§åˆ¶

    è¿™æ˜¯ä¸å¯åå•†çš„ã€‚ä»æ•°æ®å‡†å¤‡è„šæœ¬åˆ°æ¨¡å‹è®­ç»ƒä»£ç çš„æ‰€æœ‰ä»£ç éƒ½åº”è¯¥åœ¨Gitï¼ˆæˆ–å¦ä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç¼©å†™ä¸ºVCSï¼‰ä¸­ã€‚æ¯ä¸ªå®éªŒéƒ½åº”è¯¥ç†æƒ³åœ°ä¸Gitæäº¤æˆ–æ ‡ç­¾ç›¸å…³è”ã€‚

    ![ä»£ç ç‰ˆæœ¬æ§åˆ¶](https://www.dailydoseofds.com/content/images/2025/08/image-54.png)

    è¿™æ ·ï¼Œä½ å°±ç¡®åˆ‡çŸ¥é“å“ªäº›ä»£ç äº§ç”Ÿäº†å“ªä¸ªæ¨¡å‹ã€‚åœ¨å®è·µä¸­ï¼Œå›¢é˜Ÿç»å¸¸åœ¨æ¨¡å‹çš„å…ƒæ•°æ®ä¸­åŒ…å«Gitæäº¤å“ˆå¸Œã€‚è¿™å…è®¸ä»æ¨¡å‹è¿½æº¯åˆ°ä»£ç ã€‚

    ä»£ç ç‰ˆæœ¬æ§åˆ¶åœ¨è½¯ä»¶å·¥ç¨‹ä¸­æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ï¼›MLåªéœ€è¦å°†è¿™ç§ä¸¥æ ¼æ€§æ‰©å±•åˆ°å…¶ä»–å·¥ä»¶ã€‚

    ### ç‰ˆæœ¬æ•°æ®

    è¿™ä¸ªæ›´æ£˜æ‰‹ä½†è‡³å…³é‡è¦ã€‚è‡³å°‘ï¼Œå¦‚æœä½ æ­£åœ¨é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œä¿å­˜ä½¿ç”¨çš„ç¡®åˆ‡æ•°æ®çš„å¿«ç…§æˆ–å¼•ç”¨ã€‚å¦‚æœè®­ç»ƒæ•°æ®å­˜åœ¨äºæ•°æ®åº“ä¸­å¹¶ä¸”ä¸æ–­å˜åŒ–ï¼Œä½ å¯èƒ½éœ€è¦å¯¹å…¶è¿›è¡Œå¿«ç…§ã€‚

    å¦‚æœä¸ç®¡ç†ï¼Œä½ å¯èƒ½æœ€ç»ˆä¼šå¯¹åŒä¸€æ•°æ®çš„ä¸åŒå˜ä½“æ„Ÿåˆ°å›°æƒ‘ï¼Œä¸äº†è§£ç¡®åˆ‡ä½¿ç”¨äº†å“ªä¸€ä¸ªã€‚

    ![æ•°æ®ç‰ˆæœ¬æ§åˆ¶](https://www.dailydoseofds.com/content/images/2025/08/image-64.png)

    ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨åƒDVCï¼ˆæ•°æ®ç‰ˆæœ¬æ§åˆ¶ï¼‰è¿™æ ·çš„å·¥å…·ï¼Œå®ƒå°†Gitå·¥ä½œæµæ‰©å±•åˆ°æ•°æ®å’Œæ¨¡å‹ã€‚DVCä¸åœ¨Gitä¸­å­˜å‚¨å®é™…æ•°æ®ï¼Œä½†å­˜å‚¨å“ˆå¸Œ/å¼•ç”¨ï¼Œä»¥ä¾¿æ•°æ®æ–‡ä»¶å¯ä»¥åœ¨å¤–éƒ¨è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼ˆä¾‹å¦‚ï¼Œåœ¨äº‘å­˜å‚¨ä¸Šï¼‰ï¼ŒåŒæ—¶ä»ç„¶ä¸Gitæäº¤ç›¸å…³è”ã€‚

    ![DVCå·¥ä½œæµ](https://www.dailydoseofds.com/content/images/2025/08/image-55-1-1-1.png)

    ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨DVCè·Ÿè¸ªä½ çš„`train.csv`ï¼Œå½“ä½ æäº¤æ—¶ï¼ŒDVCè®°å½•è¯¥æ–‡ä»¶çš„å“ˆå¸Œï¼ˆæˆ–æŒ‡å‘äº‘å¯¹è±¡çš„æŒ‡é’ˆï¼‰ã€‚ç¨åï¼Œå³ä½¿æ–‡ä»¶å¾ˆå¤§ï¼Œä½ ä¹Ÿå¯ä»¥é‡ç°é‚£ä¸ªç¡®åˆ‡çš„æ–‡ä»¶ã€‚

    DVCæä¾›"ç±»ä¼¼Gitçš„ä½“éªŒæ¥ç»„ç»‡ä½ çš„æ•°æ®ã€æ¨¡å‹å’Œå®éªŒ"ã€‚
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ### æµ‹è¯•å¯é‡ç°æ€§

    è¿™å¯èƒ½å¬èµ·æ¥å¾ˆæŠ½è±¡ï¼Œä½†è¦æœ‰ä¸€ä¸ªéªŒè¯å¯é‡ç°æ€§çš„è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œåœ¨è®­ç»ƒå’Œä¿å­˜æ¨¡å‹åï¼Œä½ å¯ä»¥åšä¸€ä¸ªå¿«é€Ÿæµ‹è¯•ï¼šåŠ è½½æ¨¡å‹å¹¶åœ¨å·²çŸ¥æµ‹è¯•è¾“å…¥ä¸Šè¿è¡Œå®ƒï¼Œçœ‹çœ‹ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

    è¿™ç¡®ä¿æ¨¡å‹æ–‡ä»¶æ²¡æœ‰æŸåï¼Œç¯å¢ƒç¡®å®å¯ä»¥äº§ç”Ÿç›¸åŒçš„è¾“å‡ºã€‚å¦ä¸€ä¸ªæƒ³æ³•æ˜¯ï¼Œå¦‚æœä½ ç”¨ç›¸åŒçš„æ•°æ®é‡æ–°è®­ç»ƒæ¨¡å‹ï¼ˆä¹Ÿè®¸ç”¨ä¸åŒçš„éšæœºç§å­æˆ–åœ¨ä¸€äº›è‰¯æ€§æ›´æ”¹åï¼‰ï¼Œç¡®ä¿æŒ‡æ ‡åœ¨åŒä¸€èŒƒå›´å†…ã€‚

    å¦‚æœå®ƒä»¬å·®å¼‚å¾ˆå¤§ï¼Œå°±æœ‰é—®é¢˜ã€‚è¦ä¹ˆæ˜¯é”™è¯¯ï¼Œè¦ä¹ˆæ˜¯ä¸ç¨³å®šçš„è®­ç»ƒè¿‡ç¨‹ã€‚å¯¹äºå…³é”®æ¨¡å‹ï¼Œä½ ç”šè‡³å¯èƒ½æœ‰ä¸€ä¸ª"å¯é‡ç°æ€§æµ‹è¯•"ï¼Œä½ å°è¯•é‡æ–°è¿è¡Œæ—§çš„è®­ç»ƒä½œä¸šï¼ˆåœ¨å­˜æ¡£æ•°æ®ä¸Šï¼‰æ¥çœ‹çœ‹æ˜¯å¦å¾—åˆ°ç›¸åŒçš„ç»“æœï¼Œä½œä¸ºCIçš„ä¸€éƒ¨åˆ†ã€‚

    è¿™å¹¶ä¸å¸¸è§ï¼ˆå› ä¸ºå¯èƒ½å¾ˆæ˜‚è´µï¼‰ï¼Œä½†åœ¨æ¦‚å¿µä¸Šç±»ä¼¼äºè½¯ä»¶ä¸­çš„å›å½’æµ‹è¯•ã€‚

    ### è·Ÿè¸ªå®éªŒå’Œå…ƒæ•°æ®

    ä½¿ç”¨å®éªŒè·Ÿè¸ªå™¨ï¼ˆå¦‚MLflowï¼‰è®°å½•å®éªŒåŠå…¶è¿è¡Œçš„æ‰€æœ‰å†…å®¹ã€‚

    ![MLflowå®éªŒè·Ÿè¸ª](https://www.dailydoseofds.com/content/images/2025/08/image-63.png)

    ![MLflowç•Œé¢](https://www.dailydoseofds.com/content/images/2025/08/image-59.png)

    è¿™é€šå¸¸æ„å‘³ç€å½“ä½ æ‰§è¡Œè®­ç»ƒè„šæœ¬æ—¶ï¼Œå®ƒä¼šè®°å½•ï¼š

    - å”¯ä¸€çš„è¿è¡ŒID
    - ä½¿ç”¨çš„å‚æ•°ï¼ˆè¶…å‚æ•°ã€è®­ç»ƒè½®æ¬¡ç­‰ï¼‰
    - æŒ‡æ ‡ï¼ˆå‡†ç¡®æ€§ã€å„è½®æ¬¡çš„æŸå¤±ç­‰ï¼‰
    - ä»£ç ç‰ˆæœ¬ï¼ˆé€šè¿‡Gitå“ˆå¸Œï¼Œå¦‚ä¸Šæ‰€è¿°ï¼‰
    - æ•°æ®ç‰ˆæœ¬ï¼ˆä¹Ÿè®¸æ˜¯DVCæ•°æ®å“ˆå¸Œæˆ–æ•°æ®é›†IDï¼‰
    - æ¨¡å‹å·¥ä»¶æˆ–å¯¹å®ƒçš„å¼•ç”¨
    - å¯èƒ½çš„ç¯å¢ƒä¿¡æ¯ï¼ˆåº“ç‰ˆæœ¬ï¼‰

    æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œä½ å°±æœ‰äº†æ¯ä¸ªå®éªŒçš„è®°å½•ã€‚å¦‚æœè¿è¡Œ#42æ˜¯æœ€å¥½çš„å¹¶æˆä¸ºç”Ÿäº§ï¼Œä»»ä½•äººéƒ½å¯ä»¥æ£€æŸ¥è¿è¡Œ#42çš„è¯¦ç»†ä¿¡æ¯ï¼Œç†æƒ³æƒ…å†µä¸‹é€šè¿‡æ£€å‡ºç›¸åŒçš„ä»£ç å¹¶ç”¨ç›¸åŒçš„æ•°æ®å’Œå‚æ•°é‡æ–°è¿è¡Œæ¥é‡ç°å®ƒã€‚

    ğŸ‘‰

    ä¸€äº›å·¥å…·ç”šè‡³å…è®¸å…‹éš†å®éªŒè¿è¡Œï¼ˆå¦‚W&Bæœ‰ä¸€ä¸ªåŠŸèƒ½å¯ä»¥è½»æ¾åŒæ­¥ä»£ç å¹¶è¿è¡Œå®ƒï¼‰ã€‚æ›´ç®€å•çš„æ˜¯ï¼Œåªæ˜¯æœ‰ä¸€ä¸ªç»“æ„åŒ–çš„æ—¥å¿—æ„å‘³ç€æ‰‹åŠ¨é‡ç°ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚

    è¯·æ³¨æ„ï¼ŒMLflowä¸­çš„å®éªŒæ˜¯è¿è¡Œçš„å‘½åé›†åˆï¼Œå…¶ä¸­æ¯ä¸ªè¿è¡Œä»£è¡¨æœºå™¨å­¦ä¹ å·¥ä½œæµæˆ–è®­ç»ƒè¿‡ç¨‹çš„ç‰¹å®šæ‰§è¡Œã€‚

    ![MLflowå®éªŒæ¦‚å¿µ](https://www.dailydoseofds.com/content/images/2025/08/image-60.png)

    è¿›ä¸€æ­¥è¯¦ç»†è¯´æ˜ï¼Œè¿è¡Œæ˜¯ç‰¹å®šå®éªŒå†…æœºå™¨å­¦ä¹ å·¥ä½œæµçš„å•æ¬¡æ‰§è¡Œã€‚

    å®ƒå°è£…äº†è¯¥ç‰¹å®šæ‰§è¡Œçš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿è¡ŒæœŸé—´äº§ç”Ÿçš„ä»£ç ã€å‚æ•°ã€æŒ‡æ ‡å’Œå·¥ä»¶ã€‚

    ![MLflowè¿è¡Œæ¦‚å¿µ](https://www.dailydoseofds.com/content/images/2025/08/image-61.png)
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ### ç‰ˆæœ¬æ¨¡å‹å·¥ä»¶

    æ¯æ¬¡è®­ç»ƒå¯èƒ½æŠ•å…¥ç”Ÿäº§çš„æ¨¡å‹æ—¶ï¼Œç»™å®ƒä¸€ä¸ªç‰ˆæœ¬å·æˆ–IDã€‚åœ¨æ¨¡å‹æ³¨å†Œè¡¨ä¸­æ³¨å†Œå®ƒã€‚

    ![æ¨¡å‹æ³¨å†Œè¡¨](https://www.dailydoseofds.com/content/images/2025/08/image-58.png)

    åƒMLflowè¿™æ ·çš„å·¥å…·æä¾›äº†ä¸€ä¸ªä¸­å¤®ä½ç½®æ¥ç®¡ç†å…·æœ‰ç‰ˆæœ¬å’Œé˜¶æ®µçš„æ¨¡å‹ï¼ˆä¾‹å¦‚ï¼Œ"v1â€“staging"ã€"v1â€“production"ï¼‰ã€‚

    ![MLflowæ¨¡å‹æ³¨å†Œè¡¨](https://www.dailydoseofds.com/content/images/2025/08/image-56.png)

    æ¨¡å‹æ³¨å†Œè¡¨æ¡ç›®åŒ…å«æ¨¡å‹å·¥ä»¶å’Œå…ƒæ•°æ®ï¼Œå¦‚è°åˆ›å»ºäº†å®ƒã€ä½•æ—¶åˆ›å»ºï¼Œé€šå¸¸è¿˜æœ‰å¯¹å®éªŒæˆ–ä»£ç çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼ŒMLflowçš„æ¨¡å‹æ³¨å†Œè¡¨æä¾›UIå’ŒAPIæ¥åœ¨é˜¶æ®µä¹‹é—´è½¬æ¢æ¨¡å‹å¹¶ä¿æŒå†å²è®°å½•ã€‚

    ![æ¨¡å‹æ³¨å†Œè¡¨UI](https://www.dailydoseofds.com/content/images/2025/08/image-57.png)

    å®ƒè¿˜å­˜å‚¨è¡€ç¼˜ï¼Œå³å“ªä¸ªè¿è¡Œï¼ˆä½¿ç”¨å“ªäº›å‚æ•°å’Œæ•°æ®ï¼‰äº§ç”Ÿäº†è¯¥æ¨¡å‹ã€‚é€šè¿‡ä½¿ç”¨è¿™æ ·çš„æ³¨å†Œè¡¨ï¼Œä½ ç¡®ä¿å³ä½¿ä»Šå¤©éƒ¨ç½²æ¨¡å‹v5ï¼Œå¦‚æœéœ€è¦ï¼Œä½ ä»ç„¶å¯ä»¥è·å–æ¨¡å‹v3ï¼Œå¹¶ä¸”ä½ ç¡®åˆ‡çŸ¥é“æ¯ä¸ªç‰ˆæœ¬æ˜¯ä»€ä¹ˆã€‚

    ### æ•°æ®å’Œæ¨¡å‹è¡€ç¼˜è®°å½•

    å½“è®­ç»ƒæ¨¡å‹æ—¶ï¼Œè®°å½•å¯¹ç¡®åˆ‡æ•°æ®çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä½¿ç”¨å¸¦æœ‰åˆ†åŒºçš„æ•°æ®æ¹–ï¼Œæ³¨æ„å“ªä¸ªåˆ†åŒºæˆ–æ—¶é—´æˆ³ã€‚å¦‚æœä½ æŸ¥è¯¢æ•°æ®åº“ï¼Œåœ¨æ—¥å¿—ä¸­åŒ…å«æŸ¥è¯¢æˆ–æ•°æ®æ ¡éªŒå’Œã€‚

    ä¸€äº›é«˜çº§è®¾ç½®ä½¿ç”¨æ•°æ®è¡€ç¼˜å·¥å…·ï¼ˆå¦‚é€šè¿‡ç®¡é“è·Ÿè¸ªæ•°æ®æ¥æºï¼‰ã€‚å¯¹å¤§å¤šæ•°äººæ¥è¯´ï¼Œå³ä½¿åªæ˜¯è®°å½•"ä½¿ç”¨äº†å¤§å°ä¸ºYå­—èŠ‚ã€æ ¡éªŒå’Œä¸ºZçš„æ–‡ä»¶X"ä¹Ÿå¾ˆæ£’ã€‚å®ƒå…è®¸ä½ ç¨åéªŒè¯ä½ æœ‰ç›¸åŒçš„æ–‡ä»¶ã€‚å¦‚æœä½¿ç”¨DVCï¼ŒDVCæäº¤IDå……å½“é“¾æ¥ã€‚

    ### ç¯å¢ƒç®¡ç†

    ä½¿ç”¨å·¥å…·æ•è·è½¯ä»¶ç¯å¢ƒï¼š

    - ä½¿ç”¨`requirements.txt`æˆ–`environment.yml`ï¼ˆå¯¹äºCondaï¼‰æ¥å›ºå®šè®­ç»ƒå’Œæ¨ç†æ‰€éœ€çš„åº“ç‰ˆæœ¬ã€‚
    - é¿å…"æµ®åŠ¨"ä¾èµ–é¡¹ï¼ˆå¦‚åªè¯´`pandas`è€Œä¸æŒ‡å®šç‰ˆæœ¬ï¼‰ï¼Œå› ä¸ºåº“çš„æ›´æ–°å¯èƒ½ä¼šæ”¹å˜è¡Œä¸ºã€‚
    - å¦‚æœå¯èƒ½ï¼Œå®¹å™¨åŒ–ï¼šDockeré•œåƒå¯ä»¥ä½œä¸ºç¯å¢ƒçš„ç²¾ç¡®å¿«ç…§ã€‚ä½ ç”šè‡³å¯ä»¥å¯¹Dockeré•œåƒè¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼ˆå¦‚`my-train-env:v1`ï¼‰ã€‚
    - å¦‚æœä¸ä½¿ç”¨å®¹å™¨ï¼Œä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæ¥éš”ç¦»ä¾èµ–é¡¹ã€‚è¿™æ ·ï¼Œä¸€å¹´åä½¿ç”¨ç›¸åŒçš„`requirements.txt`è¿è¡Œç®¡é“å¯ä»¥ï¼ˆå¸Œæœ›ï¼‰é‡æ–°åˆ›å»ºæ‰€éœ€çš„ç¯å¢ƒã€‚
    - åŸºç¡€è®¾æ–½å³ä»£ç ï¼šå¦‚æœä½ çš„è®­ç»ƒæ¶‰åŠå¯åŠ¨æŸäº›äº‘å®ä¾‹æˆ–ä½¿ç”¨ç‰¹å®šç¡¬ä»¶ï¼Œå°†å…¶è„šæœ¬åŒ–ã€‚è¿™æ ·ï¼Œå³ä½¿æ˜¯æ„å¤–ä½¿ç”¨å…·æœ‰ä¸åŒåŠŸèƒ½çš„GPUç­‰åŸºç¡€è®¾æ–½å·®å¼‚ä¹Ÿä¸å¤ªå¯èƒ½æ½œå…¥ã€‚

    ### æƒè¡¡

    å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç»å¯¹å¯é‡ç°æ€§ï¼ˆä½å¯¹ä½ï¼‰æœ‰æ—¶æ˜¯ä¸å¿…è¦çš„ä¸¥æ ¼ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å…³å¿ƒçš„æ˜¯æ€§èƒ½æˆ–è¡Œä¸ºåœ¨å®¹å·®èŒƒå›´å†…æ˜¯å¯é‡ç°çš„ï¼Œè€Œä¸æ˜¯ç¡®åˆ‡çš„æƒé‡ã€‚

    ä¾‹å¦‚ï¼Œå¦‚æœè®­ç»ƒæ·±åº¦ç½‘ç»œä¸€æ¬¡ç»™å‡º0.859çš„å‡†ç¡®æ€§ï¼Œä¸‹æ¬¡ç»™å‡º0.851ï¼Œåœ¨æœ‰ç”¨æ€§æ–¹é¢è¿™å®é™…ä¸Šæ˜¯ç›¸åŒçš„ã€‚è¯•å›¾è·å¾—ç›¸åŒçš„æƒé‡å¯èƒ½æ˜¯è¿‡åº¦çš„ã€‚

    ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸€æ¬¡å¾—åˆ°0.88ï¼Œå¦ä¸€æ¬¡åœ¨æ®è¯´ç›¸åŒçš„è®¾ç½®ä¸‹å¾—åˆ°0.80ï¼Œè¿™è¡¨æ˜æœ‰é—®é¢˜ï¼ˆå¦‚ä¹Ÿè®¸æœ‰äº›ä½ æ²¡æœ‰æ§åˆ¶çš„ä¸œè¥¿æ”¹å˜äº†ï¼‰ã€‚

    æ‰€ä»¥è¦è¿½æ±‚ä¸€è‡´æ€§ï¼Œä½†ä¸è¦å› ä¸ºéç¡®å®šæ€§å¼•èµ·çš„å¾®å°å·®å¼‚è€Œææ…Œã€‚ä»å•†ä¸šè§’åº¦æ¥çœ‹ï¼Œé‡è¦çš„æ˜¯è´¨é‡çš„ä¸€è‡´æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ å¯ä»¥è½»æ¾å®ç°ä½å¯¹ä½å¯é‡ç°æ€§ï¼Œå°±è¿™æ ·åšï¼Œå› ä¸ºå®ƒç®€åŒ–äº†è°ƒè¯•ï¼Œä½†è¦æ„è¯†åˆ°å¦‚å‰æ‰€è¿°çš„éç¡®å®šæ€§æ¥æºã€‚
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    æ€»ç»“ä¸€åˆ‡ï¼Œåœ¨å®è·µä¸­ï¼Œå®ç°å¯é‡ç°æ€§éœ€è¦çºªå¾‹å’Œæ–‡åŒ–ï¼Œå°±åƒéœ€è¦å·¥å…·ä¸€æ ·ã€‚ä½ å¿…é¡»çŒè¾“è¿™æ ·çš„ä¹ æƒ¯ï¼š"æˆ‘æäº¤äº†é‚£ä¸ªä»£ç å—ï¼Ÿæˆ‘æ ‡è®°äº†æ•°æ®ç‰ˆæœ¬å—ï¼Ÿæˆ‘åœ¨è®°å½•è¿è¡Œå—ï¼Ÿ"

    æœ‰æ—¶ï¼Œå¿«é€Ÿå®éªŒè¯±ä½¿äººä»¬å¿«é€Ÿåšäº‹è€Œä¸è·Ÿè¸ªï¼Œä½†è¿™å¯èƒ½å¯¼è‡´ä»¥åèŠ±è´¹æ›´å¤šæ—¶é—´æ¥ç†æ¸…åšäº†ä»€ä¹ˆã€‚ä¸€ä¸ªå¸¸è§çš„æ ¼è¨€æ˜¯ï¼š"å¦‚æœå®ƒæ²¡æœ‰è¢«è®°å½•æˆ–ç‰ˆæœ¬æ§åˆ¶ï¼Œå®ƒå°±æ²¡æœ‰å‘ç”Ÿã€‚"

    æ‰€ä»¥å›¢é˜Ÿç»å¸¸é‡‡ç”¨æ£€æŸ¥æ¸…å•æˆ–è‡ªåŠ¨åŒ–æ¥å¼ºåˆ¶æ‰§è¡Œè¿™ä¸€ç‚¹ï¼ˆä¾‹å¦‚ï¼Œè®­ç»ƒè„šæœ¬è‡ªåŠ¨è®°å½•åˆ°MLflowï¼Œæ‰€ä»¥ä½ ä¸èƒ½å¿˜è®°ï¼‰ã€‚

    æ€»çš„æ¥è¯´ï¼Œå¯é‡ç°æ€§å’Œç‰ˆæœ¬æ§åˆ¶æ˜¯ä½¿MLé¡¹ç›®åœ¨é•¿æœŸå†…å¯ç®¡ç†å’Œå¯é çš„å› ç´ ã€‚å®ƒä»¬å°†MLä»ä¸€æ¬¡æ€§è‰ºæœ¯è½¬å˜ä¸ºå·¥ç¨‹å­¦ç§‘ã€‚

    é€šè¿‡å¯¹ä¸€åˆ‡è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼ˆä»£ç ã€æ•°æ®ã€æ¨¡å‹ã€é…ç½®ï¼‰å¹¶ä½¿ç”¨å·¥å…·æ¥å¸®åŠ©è·Ÿè¸ªå®ƒï¼Œæˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„æ¨¡å‹åˆ›å»ºäº†å®¡è®¡è·Ÿè¸ªã€‚è¿™ä¸ä»…å»ºç«‹äº†ä¿¡å¿ƒï¼ˆæˆ‘ä»¬å¯ä»¥è°ƒè¯•ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹è¿›ï¼Œæˆ‘ä»¬å¯ä»¥ä¿¡ä»»ç”Ÿäº§ä¸­è¿è¡Œçš„å†…å®¹ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“å®ƒæ¥è‡ªå“ªé‡Œï¼‰ï¼Œè¿˜èŠ‚çœäº†æ—¶é—´ã€‚

    ![å¯é‡ç°æ€§ä»·å€¼](https://www.dailydoseofds.com/content/images/2025/08/image-62.png)

    æ­£å¦‚ä¿—è¯è¯´ï¼Œ"å¦‚æœå®ƒä¸å¯é‡ç°ï¼Œå®ƒå°±ä¸æ˜¯ç§‘å­¦ã€‚"åœ¨MLOpsä¸­ï¼Œå¦‚æœå®ƒä¸å¯é‡ç°ï¼Œå®ƒåœ¨ç”Ÿäº§ä¸­å°±ä¸ä¼šç¨³å¥ã€‚

    ç°åœ¨æˆ‘ä»¬å·²ç»æ¶µç›–äº†å…³é”®åŸåˆ™ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å®è·µæ¨¡æ‹Ÿå°†è¿™äº›æƒ³æ³•ä»˜è¯¸å®è·µã€‚

    ---

    ## PyTorchæ¨¡å‹è®­ç»ƒå¾ªç¯å’Œæ¨¡å‹æŒä¹…åŒ–

    åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¯´æ˜äº†ç¥ç»ç½‘ç»œçš„ç®€å•PyTorchè®­ç»ƒå¾ªç¯ï¼ŒåŒ…æ‹¬å¦‚ä½•å¤„ç†å¯é‡ç°æ€§ï¼ˆä½¿ç”¨ç§å­ï¼‰ä»¥åŠå¦‚ä½•ä¿å­˜å’ŒåŠ è½½æ¨¡å‹æƒé‡ã€‚

    æˆ‘ä»¬åœ¨è¿™é‡Œä¸ä¼šä½¿ç”¨å®éªŒè·Ÿè¸ªå™¨ä»¥ä¿æŒç®€æ´ï¼Œä½†ä¼šæ˜¾ç¤ºè®°å½•æ‰“å°å’Œä¿å­˜ã€‚åœ¨å®è·µä¸­ï¼Œä½ ä¼šå°†å…¶ä¸W&Bæˆ–MLflowç­‰å·¥å…·é›†æˆã€‚

    ğŸ‘‰

    ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬ç¨åä¼šåœ¨å•ç‹¬çš„ç¤ºä¾‹ä¸­ä»‹ç»å¦‚ä½•ä½¿ç”¨MLflowè¿›è¡Œå®éªŒè·Ÿè¸ªã€‚

    ### é¡¹ç›®è®¾ç½®

    è¿™ä¸ªé¡¹ç›®çš„ä»£ç æ—¨åœ¨ä½¿ç”¨Google Colabè¿è¡Œã€‚æˆ‘ä»¬å»ºè®®åœ¨Colabä¸­ä¸Šä¼ `.ipynb`ç¬”è®°æœ¬ï¼Œå¹¶ä»é‚£é‡Œè¿è¡Œå®ƒã€‚

    åœ¨è¿™é‡Œä¸‹è½½ç¬”è®°æœ¬ï¼š

    [MLOps-Reproducibility-PyTorch.ipynb](https://www.dailydoseofds.com/content/files/2025/08/MLOps-Reproducibility-PyTorch.zip)

    ### ä»£ç å®ç°

    è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªå®Œæ•´çš„PyTorchè®­ç»ƒç¤ºä¾‹ï¼Œå±•ç¤ºå¯é‡ç°æ€§çš„æœ€ä½³å®è·µï¼š

    ```python
    import torch
    import torch.nn as nn
    import torch.optim as optim
    from torch.utils.data import DataLoader, TensorDataset
    import numpy as np
    import random
    import os
    from datetime import datetime
    import json

    # è®¾ç½®éšæœºç§å­ä»¥ç¡®ä¿å¯é‡ç°æ€§
    def set_seed(seed=42):
        random.seed(seed)
        np.random.seed(seed)
        torch.manual_seed(seed)
        torch.cuda.manual_seed(seed)
        torch.cuda.manual_seed_all(seed)
        # ç¡®ä¿CUDAæ“ä½œçš„ç¡®å®šæ€§
        torch.backends.cudnn.deterministic = True
        torch.backends.cudnn.benchmark = False
        os.environ['PYTHONHASHSEED'] = str(seed)

    # è®¾ç½®ç§å­
    set_seed(42)

    # åˆ›å»ºç®€å•çš„ç¥ç»ç½‘ç»œ
    class SimpleNN(nn.Module):
        def __init__(self, input_size, hidden_size, output_size):
            super(SimpleNN, self).__init__()
            self.fc1 = nn.Linear(input_size, hidden_size)
            self.relu = nn.ReLU()
            self.fc2 = nn.Linear(hidden_size, output_size)

        def forward(self, x):
            x = self.fc1(x)
            x = self.relu(x)
            x = self.fc2(x)
            return x

    # ç”Ÿæˆåˆæˆæ•°æ®
    def generate_data(n_samples=1000, n_features=10, seed=42):
        np.random.seed(seed)
        X = np.random.randn(n_samples, n_features)
        y = (X.sum(axis=1) > 0).astype(int)  # ç®€å•çš„äºŒåˆ†ç±»
        return X.astype(np.float32), y

    # è®­ç»ƒå‡½æ•°
    def train_model(model, train_loader, criterion, optimizer, num_epochs=100):
        model.train()
        train_losses = []

        for epoch in range(num_epochs):
            epoch_loss = 0.0
            for batch_x, batch_y in train_loader:
                optimizer.zero_grad()
                outputs = model(batch_x)
                loss = criterion(outputs.squeeze(), batch_y.float())
                loss.backward()
                optimizer.step()
                epoch_loss += loss.item()

            avg_loss = epoch_loss / len(train_loader)
            train_losses.append(avg_loss)

            if (epoch + 1) % 20 == 0:
                print(f'Epoch [{epoch+1}/{num_epochs}], Loss: {avg_loss:.4f}')

        return train_losses
    ```

    è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨PyTorchä¸­å®ç°å¯é‡ç°çš„è®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…æ‹¬ç§å­è®¾ç½®ã€æ¨¡å‹å®šä¹‰å’Œè®­ç»ƒå¾ªç¯ã€‚
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ### æ¨¡å‹ä¿å­˜å’ŒåŠ è½½

    è®©æˆ‘ä»¬ç»§ç»­å±•ç¤ºå¦‚ä½•æ­£ç¡®ä¿å­˜å’ŒåŠ è½½æ¨¡å‹ï¼ŒåŒ…æ‹¬å…ƒæ•°æ®ï¼š

    ```python
    # æ¨¡å‹ä¿å­˜å‡½æ•°
    def save_model_with_metadata(model, model_path, metadata):
        # åˆ›å»ºä¿å­˜ç›®å½•
        os.makedirs(os.path.dirname(model_path), exist_ok=True)

        # ä¿å­˜æ¨¡å‹çŠ¶æ€å­—å…¸
        torch.save(model.state_dict(), model_path)

        # ä¿å­˜å…ƒæ•°æ®
        metadata_path = model_path.replace('.pth', '_metadata.json')
        with open(metadata_path, 'w') as f:
            json.dump(metadata, f, indent=2)

        print(f"æ¨¡å‹å·²ä¿å­˜åˆ°: {model_path}")
        print(f"å…ƒæ•°æ®å·²ä¿å­˜åˆ°: {metadata_path}")

    # æ¨¡å‹åŠ è½½å‡½æ•°
    def load_model_with_metadata(model_class, model_path, model_params):
        # åŠ è½½å…ƒæ•°æ®
        metadata_path = model_path.replace('.pth', '_metadata.json')
        with open(metadata_path, 'r') as f:
            metadata = json.load(f)

        # åˆ›å»ºæ¨¡å‹å®ä¾‹
        model = model_class(**model_params)

        # åŠ è½½æ¨¡å‹æƒé‡
        model.load_state_dict(torch.load(model_path))

        print(f"æ¨¡å‹å·²ä» {model_path} åŠ è½½")
        print(f"è®­ç»ƒæ—¶é—´: {metadata['training_time']}")
        print(f"æœ€ç»ˆæŸå¤±: {metadata['final_loss']:.4f}")

        return model, metadata

    # ä¸»è®­ç»ƒè„šæœ¬
    def main():
        # è®¾ç½®å‚æ•°
        config = {
            'input_size': 10,
            'hidden_size': 64,
            'output_size': 1,
            'learning_rate': 0.001,
            'batch_size': 32,
            'num_epochs': 100,
            'seed': 42
        }

        # è®¾ç½®ç§å­
        set_seed(config['seed'])

        # ç”Ÿæˆæ•°æ®
        X, y = generate_data(n_samples=1000, n_features=config['input_size'])

        # åˆ›å»ºæ•°æ®åŠ è½½å™¨
        dataset = TensorDataset(torch.tensor(X), torch.tensor(y))
        train_loader = DataLoader(dataset, batch_size=config['batch_size'], shuffle=True)

        # åˆ›å»ºæ¨¡å‹
        model = SimpleNN(config['input_size'], config['hidden_size'], config['output_size'])

        # å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨
        criterion = nn.BCEWithLogitsLoss()
        optimizer = optim.Adam(model.parameters(), lr=config['learning_rate'])

        # è®­ç»ƒæ¨¡å‹
        print("å¼€å§‹è®­ç»ƒ...")
        start_time = datetime.now()
        train_losses = train_model(model, train_loader, criterion, optimizer, config['num_epochs'])
        end_time = datetime.now()

        # å‡†å¤‡å…ƒæ•°æ®
        metadata = {
            'config': config,
            'training_time': str(end_time - start_time),
            'final_loss': train_losses[-1],
            'model_architecture': str(model),
            'timestamp': datetime.now().isoformat(),
            'pytorch_version': torch.__version__,
            'numpy_version': np.__version__
        }

        # ä¿å­˜æ¨¡å‹
        model_path = 'models/simple_nn_model.pth'
        save_model_with_metadata(model, model_path, metadata)

        return model, metadata

    # è¿è¡Œè®­ç»ƒ
    if __name__ == "__main__":
        trained_model, training_metadata = main()
    ```

    è¿™ä¸ªå®Œæ•´çš„ç¤ºä¾‹å±•ç¤ºäº†ï¼š
    - å¦‚ä½•è®¾ç½®éšæœºç§å­ç¡®ä¿å¯é‡ç°æ€§
    - å¦‚ä½•ä¿å­˜æ¨¡å‹æƒé‡å’Œè®­ç»ƒå…ƒæ•°æ®
    - å¦‚ä½•åŠ è½½æ¨¡å‹å¹¶éªŒè¯å…¶é…ç½®
    - å¦‚ä½•è®°å½•è®­ç»ƒè¿‡ç¨‹çš„å…³é”®ä¿¡æ¯
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## MLflowå®éªŒè·Ÿè¸ªå’Œæ¨¡å‹æ³¨å†Œ

    ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨MLflowæ¥è·Ÿè¸ªå®éªŒå’Œæ³¨å†Œæ¨¡å‹ã€‚MLflowæ˜¯ä¸€ä¸ªå¼€æºå¹³å°ï¼Œç”¨äºç®¡ç†MLç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬å®éªŒã€å¯é‡ç°æ€§å’Œéƒ¨ç½²ã€‚

    ### MLflowåŸºç¡€æ¦‚å¿µ

    åœ¨æ·±å…¥ä»£ç ä¹‹å‰ï¼Œè®©æˆ‘ä»¬äº†è§£MLflowçš„æ ¸å¿ƒæ¦‚å¿µï¼š

    - **å®éªŒï¼ˆExperimentï¼‰**ï¼šç›¸å…³è¿è¡Œçš„é›†åˆï¼Œé€šå¸¸å¯¹åº”ä¸€ä¸ªMLé¡¹ç›®æˆ–é—®é¢˜
    - **è¿è¡Œï¼ˆRunï¼‰**ï¼šå•æ¬¡æ¨¡å‹è®­ç»ƒæ‰§è¡Œï¼ŒåŒ…å«å‚æ•°ã€æŒ‡æ ‡å’Œå·¥ä»¶
    - **å·¥ä»¶ï¼ˆArtifactsï¼‰**ï¼šä¸è¿è¡Œç›¸å…³çš„æ–‡ä»¶ï¼Œå¦‚æ¨¡å‹ã€å›¾è¡¨ã€æ•°æ®ç­‰
    - **æ¨¡å‹æ³¨å†Œè¡¨ï¼ˆModel Registryï¼‰**ï¼šç”¨äºç®¡ç†æ¨¡å‹ç‰ˆæœ¬å’Œç”Ÿå‘½å‘¨æœŸçš„ä¸­å¤®å­˜å‚¨åº“

    ### å®‰è£…å’Œè®¾ç½®

    ```bash
    pip install mlflow
    pip install scikit-learn pandas numpy matplotlib
    ```

    ### ä½¿ç”¨MLflowè·Ÿè¸ªå®éªŒ

    è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä½¿ç”¨MLflowè·Ÿè¸ªçš„å®Œæ•´ç¤ºä¾‹ï¼š

    ```python
    import mlflow
    import mlflow.sklearn
    import mlflow.pytorch
    from sklearn.datasets import make_classification
    from sklearn.model_selection import train_test_split
    from sklearn.ensemble import RandomForestClassifier
    from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score
    import pandas as pd
    import numpy as np
    import matplotlib.pyplot as plt
    import os
    from datetime import datetime

    # è®¾ç½®MLflowè·Ÿè¸ªURIï¼ˆæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼‰
    mlflow.set_tracking_uri("file:./mlruns")

    # åˆ›å»ºæˆ–è®¾ç½®å®éªŒ
    experiment_name = "å¯é‡ç°æ€§æ¼”ç¤ºå®éªŒ"
    try:
        experiment_id = mlflow.create_experiment(experiment_name)
    except mlflow.exceptions.MlflowException:
        experiment_id = mlflow.get_experiment_by_name(experiment_name).experiment_id

    mlflow.set_experiment(experiment_name)

    def run_ml_experiment(n_estimators=100, max_depth=10, random_state=42):
        with mlflow.start_run() as run:
            # è®°å½•å‚æ•°
            mlflow.log_param("n_estimators", n_estimators)
            mlflow.log_param("max_depth", max_depth)
            mlflow.log_param("random_state", random_state)
            mlflow.log_param("algorithm", "RandomForest")

            # ç”Ÿæˆæ•°æ®
            X, y = make_classification(
                n_samples=1000,
                n_features=20,
                n_informative=10,
                n_redundant=10,
                random_state=random_state
            )

            # åˆ†å‰²æ•°æ®
            X_train, X_test, y_train, y_test = train_test_split(
                X, y, test_size=0.2, random_state=random_state
            )

            # è®­ç»ƒæ¨¡å‹
            model = RandomForestClassifier(
                n_estimators=n_estimators,
                max_depth=max_depth,
                random_state=random_state
            )

            start_time = datetime.now()
            model.fit(X_train, y_train)
            training_time = (datetime.now() - start_time).total_seconds()

            # é¢„æµ‹
            y_pred = model.predict(X_test)

            # è®¡ç®—æŒ‡æ ‡
            accuracy = accuracy_score(y_test, y_pred)
            precision = precision_score(y_test, y_pred)
            recall = recall_score(y_test, y_pred)
            f1 = f1_score(y_test, y_pred)

            # è®°å½•æŒ‡æ ‡
            mlflow.log_metric("accuracy", accuracy)
            mlflow.log_metric("precision", precision)
            mlflow.log_metric("recall", recall)
            mlflow.log_metric("f1_score", f1)
            mlflow.log_metric("training_time_seconds", training_time)

            # è®°å½•æ¨¡å‹
            mlflow.sklearn.log_model(
                model,
                "model",
                registered_model_name="RandomForestDemo"
            )

            # åˆ›å»ºå¹¶è®°å½•ç‰¹å¾é‡è¦æ€§å›¾
            feature_importance = pd.DataFrame({
                'feature': [f'feature_{i}' for i in range(X.shape[1])],
                'importance': model.feature_importances_
            }).sort_values('importance', ascending=False)

            plt.figure(figsize=(10, 6))
            plt.barh(feature_importance['feature'][:10], feature_importance['importance'][:10])
            plt.title('Top 10 Feature Importances')
            plt.xlabel('Importance')
            plt.tight_layout()
            plt.savefig('feature_importance.png')
            mlflow.log_artifact('feature_importance.png')
            plt.close()

            # è®°å½•æ•°æ®é›†ä¿¡æ¯
            mlflow.log_param("train_samples", len(X_train))
            mlflow.log_param("test_samples", len(X_test))
            mlflow.log_param("n_features", X.shape[1])

            print(f"è¿è¡ŒID: {run.info.run_id}")
            print(f"å‡†ç¡®ç‡: {accuracy:.4f}")
            print(f"F1åˆ†æ•°: {f1:.4f}")

            return run.info.run_id, model

    # è¿è¡Œå¤šä¸ªå®éªŒ
    print("è¿è¡Œå®éªŒ1: é»˜è®¤å‚æ•°")
    run_id_1, model_1 = run_ml_experiment()

    print("\nè¿è¡Œå®éªŒ2: æ›´å¤šæ ‘")
    run_id_2, model_2 = run_ml_experiment(n_estimators=200)

    print("\nè¿è¡Œå®éªŒ3: æ›´æ·±çš„æ ‘")
    run_id_3, model_3 = run_ml_experiment(max_depth=20)
    ```

    è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨MLflowæ¥ï¼š

    - è·Ÿè¸ªå®éªŒå‚æ•°å’ŒæŒ‡æ ‡
    - è®°å½•æ¨¡å‹å·¥ä»¶
    - ä¿å­˜å¯è§†åŒ–ç»“æœ
    - è‡ªåŠ¨æ³¨å†Œæ¨¡å‹åˆ°æ¨¡å‹æ³¨å†Œè¡¨
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ### æ¨¡å‹æ³¨å†Œè¡¨æ“ä½œ

    MLflowæ¨¡å‹æ³¨å†Œè¡¨æä¾›äº†ä¸€ä¸ªä¸­å¤®ä½ç½®æ¥ç®¡ç†æ¨¡å‹çš„ç”Ÿå‘½å‘¨æœŸã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒï¼š

    ```python
    from mlflow.tracking import MlflowClient

    # åˆ›å»ºMLflowå®¢æˆ·ç«¯
    client = MlflowClient()

    # åˆ—å‡ºæ‰€æœ‰æ³¨å†Œçš„æ¨¡å‹
    registered_models = client.list_registered_models()
    print("æ³¨å†Œçš„æ¨¡å‹:")
    for model in registered_models:
        print(f"- {model.name}")

    # è·å–ç‰¹å®šæ¨¡å‹çš„ç‰ˆæœ¬
    model_name = "RandomForestDemo"
    model_versions = client.get_registered_model(model_name)
    print(f"\n{model_name} çš„ç‰ˆæœ¬:")
    for version in model_versions.latest_versions:
        print(f"- ç‰ˆæœ¬ {version.version}: {version.current_stage}")

    # è½¬æ¢æ¨¡å‹é˜¶æ®µ
    def transition_model_stage(model_name, version, stage):
        client.transition_model_version_stage(
            name=model_name,
            version=version,
            stage=stage
        )
        print(f"æ¨¡å‹ {model_name} ç‰ˆæœ¬ {version} å·²è½¬æ¢åˆ° {stage} é˜¶æ®µ")

    # ç¤ºä¾‹ï¼šå°†æœ€æ–°ç‰ˆæœ¬è½¬æ¢åˆ°Staging
    latest_version = client.get_latest_versions(model_name, stages=["None"])[0]
    transition_model_stage(model_name, latest_version.version, "Staging")

    # åŠ è½½ç‰¹å®šé˜¶æ®µçš„æ¨¡å‹
    def load_model_from_registry(model_name, stage="Production"):
        model_uri = f"models:/{model_name}/{stage}"
        try:
            model = mlflow.sklearn.load_model(model_uri)
            print(f"æˆåŠŸåŠ è½½ {model_name} çš„ {stage} ç‰ˆæœ¬")
            return model
        except Exception as e:
            print(f"åŠ è½½æ¨¡å‹å¤±è´¥: {e}")
            return None

    # å°è¯•åŠ è½½Stagingç‰ˆæœ¬
    staging_model = load_model_from_registry(model_name, "Staging")

    # æ¨¡å‹ç‰ˆæœ¬æ¯”è¾ƒ
    def compare_model_versions(model_name):
        versions = client.get_latest_versions(model_name)

        print(f"\n{model_name} ç‰ˆæœ¬æ¯”è¾ƒ:")
        print("-" * 50)

        for version in versions:
            run = client.get_run(version.run_id)
            metrics = run.data.metrics
            params = run.data.params

            print(f"ç‰ˆæœ¬ {version.version} ({version.current_stage}):")
            print(f"  å‡†ç¡®ç‡: {metrics.get('accuracy', 'N/A'):.4f}")
            print(f"  F1åˆ†æ•°: {metrics.get('f1_score', 'N/A'):.4f}")
            print(f"  å‚æ•°: n_estimators={params.get('n_estimators', 'N/A')}, "
                  f"max_depth={params.get('max_depth', 'N/A')}")
            print()

    # æ¯”è¾ƒæ¨¡å‹ç‰ˆæœ¬
    compare_model_versions(model_name)
    ```

    ### å¯åŠ¨MLflow UI

    è¦æŸ¥çœ‹å®éªŒå’Œæ¨¡å‹æ³¨å†Œè¡¨çš„Webç•Œé¢ï¼Œè¿è¡Œï¼š

    ```bash
    mlflow ui --backend-store-uri file:./mlruns
    ```

    ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:5000` æ¥æŸ¥çœ‹ï¼š

    - å®éªŒåˆ—è¡¨å’Œè¿è¡Œè¯¦æƒ…
    - å‚æ•°ã€æŒ‡æ ‡å’Œå·¥ä»¶çš„æ¯”è¾ƒ
    - æ¨¡å‹æ³¨å†Œè¡¨å’Œç‰ˆæœ¬ç®¡ç†
    - æ¨¡å‹è¡€ç¼˜å’Œå…ƒæ•°æ®

    ### DVCæ•°æ®ç‰ˆæœ¬æ§åˆ¶ç¤ºä¾‹

    é™¤äº†MLflowï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨DVCæ¥ç‰ˆæœ¬æ§åˆ¶æ•°æ®ï¼š

    ```bash
    # åˆå§‹åŒ–DVC
    dvc init

    # æ·»åŠ æ•°æ®æ–‡ä»¶åˆ°DVCè·Ÿè¸ª
    dvc add data/train.csv

    # æäº¤åˆ°Git
    git add data/train.csv.dvc data/.gitignore
    git commit -m "æ·»åŠ è®­ç»ƒæ•°æ®"

    # æ¨é€æ•°æ®åˆ°è¿œç¨‹å­˜å‚¨
    dvc push

    # åœ¨å¦ä¸€å°æœºå™¨ä¸Šæ‹‰å–æ•°æ®
    dvc pull
    ```

    è¿™æ ·ï¼Œæˆ‘ä»¬å°±å»ºç«‹äº†ä¸€ä¸ªå®Œæ•´çš„å¯é‡ç°æ€§å·¥ä½œæµï¼š
    - ä½¿ç”¨Gitè¿›è¡Œä»£ç ç‰ˆæœ¬æ§åˆ¶
    - ä½¿ç”¨DVCè¿›è¡Œæ•°æ®ç‰ˆæœ¬æ§åˆ¶
    - ä½¿ç”¨MLflowè¿›è¡Œå®éªŒè·Ÿè¸ªå’Œæ¨¡å‹æ³¨å†Œ
    - ä½¿ç”¨Dockerè¿›è¡Œç¯å¢ƒç‰ˆæœ¬æ§åˆ¶
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## ç»“è®º

    åœ¨MLOpså’ŒLLMOpsé€Ÿæˆè¯¾ç¨‹çš„ç¬¬ä¸‰éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¯ä»¥è¯´æ˜¯æœºå™¨å­¦ä¹ ç³»ç»Ÿæœ€é‡è¦ä½†ç»å¸¸è¢«ä½ä¼°çš„æ”¯æŸ±ä¹‹ä¸€ï¼šå¯é‡ç°æ€§å’Œç‰ˆæœ¬æ§åˆ¶ã€‚

    æˆ‘ä»¬é¦–å…ˆåŸºäºä¸ºä»€ä¹ˆå¯é‡ç°æ€§å¾ˆé‡è¦æ¥å»ºç«‹æˆ‘ä»¬çš„ç†è§£ï¼Œä¸ä»…ä½œä¸ºç†è®ºç†æƒ³ï¼Œè€Œä¸”ä½œä¸ºé•¿æœŸæ¨¡å‹å¯é æ€§çš„å®é™…è¦æ±‚ã€‚

    æˆ‘ä»¬æ¢ç´¢äº†å¯é‡ç°æ€§åœ¨æ­£ç¡®æ‰§è¡Œæ—¶å¦‚ä½•åœ¨MLç”Ÿå‘½å‘¨æœŸä¸­å»ºç«‹ä¿¡ä»»ï¼Œå¹¶ä½¿ä½ ä»Šå¤©æ‰€åšçš„å·¥ä½œèƒ½å¤Ÿåº”å¯¹æ˜å¤©çš„æœªçŸ¥ã€‚

    ä»é‚£é‡Œï¼Œæˆ‘ä»¬èµ°è¿‡äº†ä½¿æœºå™¨å­¦ä¹ ä¸­çš„å¯é‡ç°æ€§å¦‚æ­¤å›°éš¾çš„ç»†è‡´æŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯éšæœºæ€§ã€å¯å˜æ•°æ®ã€ç¯å¢ƒæ¼‚ç§»å’Œä¸´æ—¶å®éªŒï¼Œæ‰€æœ‰è¿™äº›éƒ½å°†MLä¸ä¼ ç»Ÿè½¯ä»¶å·¥ç¨‹åŒºåˆ†å¼€æ¥ã€‚

    ä¸ºäº†åº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼Œæˆ‘ä»¬ä»‹ç»äº†å…¨æ–¹ä½çš„æœ€ä½³å®è·µï¼š

    - ä½¿ç”¨Gitè¿›è¡Œä»£ç ç‰ˆæœ¬æ§åˆ¶å¹¶å°†å®éªŒä¸ç‰¹å®šæäº¤ç›¸å…³è”
    - åˆ©ç”¨DVCç­‰å·¥å…·è¿›è¡Œæ•°æ®é›†å’Œæ¨¡å‹å·¥ä»¶ç‰ˆæœ¬æ§åˆ¶
    - ä½¿ç”¨MLflowç­‰å®éªŒè·Ÿè¸ªå™¨è®°å½•å‚æ•°ã€æŒ‡æ ‡å’Œæ¨¡å‹è¡€ç¼˜
    - é€šè¿‡ç§å­å›ºå®šã€å®¹å™¨åŒ–å’Œä¾èµ–é¡¹å›ºå®šæ¥æ§åˆ¶éšæœºæ€§å’Œç¯å¢ƒ

    ä½†æˆ‘ä»¬æ²¡æœ‰æ­¢æ­¥äºç†è®ºã€‚

    é€šè¿‡å®è·µæ¼”ç»ƒï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•ï¼š

    - åœ¨PyTorchä¸­æ„å»ºå¯é‡ç°çš„è®­ç»ƒå¾ªç¯
    - ç¡®å®šæ€§åœ°ä¿å­˜å’ŒåŠ è½½æ¨¡å‹æ£€æŸ¥ç‚¹
    - ä½¿ç”¨Git + DVCå¯¹ä»£ç å’Œæ•°æ®è¿›è¡Œç‰ˆæœ¬æ§åˆ¶
    - ä½¿ç”¨MLflowè·Ÿè¸ªå®éªŒå’Œæ³¨å†Œæ¨¡å‹ï¼Œé€šè¿‡ä»£ç å’ŒUI

    è¿™äº›ç¤ºä¾‹ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¼ºåŒ–äº†ä¸€ä¸ªæ ¸å¿ƒæ€æƒ³ï¼šå¯é‡ç°æ€§ä¸æ˜¯ä½ åœ¨é¡¶éƒ¨æ’’ä¸Šçš„åŠŸèƒ½ï¼›å®ƒæ˜¯èå…¥å¼€å‘è¿‡ç¨‹çš„å¿ƒæ€ã€‚

    æˆ‘ä»¬ä¹Ÿæ‰¿è®¤äº†æƒè¡¡ã€‚æˆ‘ä»¬çœ‹åˆ°ç»å¯¹çš„ä½å¯¹ä½å¯é‡ç°æ€§å¹¶ä¸æ€»æ˜¯å¿…è¦çš„ã€‚åœ¨ç”Ÿäº§ä¸­æ›´é‡è¦çš„æ˜¯ä¸€è‡´çš„è¡Œä¸ºã€ç¨³å¥çš„æ€§èƒ½ï¼Œä»¥åŠæ¨¡å‹è¡Œä¸ºæ–¹å¼çš„å¯è¿½æº¯æ€§ã€‚

    æœ¬ç« ä¸­æœ€å¼ºçƒˆçš„ä¿¡æ¯ä¹‹ä¸€æ˜¯ï¼Œå¯é‡ç°æ€§ä¸æ˜¯å¢åŠ å¼€é”€ï¼›å®ƒæ˜¯èŠ‚çœæœªæ¥æ—¶é—´ã€é¿å…å›å½’é”™è¯¯ã€å®ç°åä½œå’Œä¿æŒé—®è´£åˆ¶ã€‚å®ƒæ˜¯å®éªŒå’Œç”Ÿäº§ä¹‹é—´çš„æ¡¥æ¢ï¼Œæ˜¯å¯æ‰©å±•ã€å¯å®¡è®¡å’Œé«˜å½±å“MLç³»ç»Ÿçš„åŸºç¡€ã€‚

    å½“æˆ‘ä»¬å±•æœ›æœ¬ç³»åˆ—çš„æœªæ¥ç« èŠ‚æ—¶ï¼Œæˆ‘ä»¬å°†åœ¨è¿™ä¸ªåšå®çš„åŸºç¡€ä¸Šæ„å»ºï¼Œæ¢ç´¢ï¼š

    - æ‰©å±•å¯é‡ç°æ€§å’Œç‰ˆæœ¬æ§åˆ¶çš„å·¥å…·
    - ä¸ºMLç³»ç»Ÿé‡èº«å®šåˆ¶çš„CI/CDå·¥ä½œæµ
    - æ¥è‡ªè¡Œä¸šçš„çœŸå®æ¡ˆä¾‹ç ”ç©¶
    - ç”Ÿäº§ä¸­çš„ç›‘æ§å’Œè§‚å¯Ÿ
    - LLMOpsçš„ç‰¹æ®Šè€ƒè™‘
    - ç»“åˆç”Ÿå‘½å‘¨æœŸæ‰€æœ‰å…ƒç´ çš„å®Œæ•´ç«¯åˆ°ç«¯ç¤ºä¾‹

    æ­£å¦‚åœ¨æ•´ä¸ªç³»åˆ—ä¸­æŒç»­å¼ºè°ƒçš„ï¼Œæœ¬è¯¾ç¨‹çš„ç›®æ ‡æ˜¯å¤§é‡å€¾å‘äºç†è®º

    å®ç°ç»†èŠ‚å¯èƒ½å› ç”¨ä¾‹ã€è§„æ¨¡å’Œè¡Œä¸šè€Œå¼‚ã€‚ä½†å¦‚æœä½ æ·±å…¥ç†è§£åº•å±‚ç³»ç»Ÿè®¾è®¡å’Œç”Ÿå‘½å‘¨æœŸåŸåˆ™ï¼Œä½ å°†æœ‰èƒ½åŠ›å¯¼èˆªä»»ä½•MLOpså †æ ˆæˆ–é€‚åº”ä»»ä½•LLMOpsåœºæ™¯ã€‚

    æ‰€ä»¥ï¼Œéšç€æˆ‘ä»¬å‰è¿›ï¼ŒæœŸå¾…çœ‹åˆ°ç†è®ºã€æ–¹æ³•å’Œæ¨¡æ‹Ÿçš„æŒç»­èåˆï¼Œå¼¥åˆå®éªŒå’Œç”Ÿäº§ä¹‹é—´çš„å·®è·ã€‚ç›®æ ‡æ˜¯å¸®åŠ©ä½ åŸ¹å…»æˆç†Ÿçš„ã€ä»¥ç³»ç»Ÿä¸ºä¸­å¿ƒçš„å¿ƒæ€ï¼Œå°†æœºå™¨å­¦ä¹ ä¸è§†ä¸ºç‹¬ç«‹å·¥ä»¶ï¼Œè€Œæ˜¯æ›´å¹¿æ³›è½¯ä»¶ç”Ÿæ€ç³»ç»Ÿçš„æ´»è·ƒéƒ¨åˆ†ã€‚

    æˆ‘ä»¬è¿˜è¦èŠ±ä¸€åˆ†é’Ÿå¼ºè°ƒï¼Œåœ¨ç³»åˆ—çš„åæœŸï¼Œä¸€æ—¦æˆ‘ä»¬è¿‡æ¸¡åˆ°LLMOpsï¼Œæˆ‘ä»¬è¿˜å°†æ¢ç´¢å½“åº”ç”¨äºåŸºäºLLMçš„ç³»ç»Ÿæ—¶ç­–ç•¥å¦‚ä½•æ¼”å˜ï¼Œå…¶ä¸­æç¤ºã€åµŒå…¥å’Œä¸Šä¸‹æ–‡çª—å£æˆä¸ºæ–°çš„ç®¡é“ï¼Œæ¨¡å‹è¡Œä¸ºå¯èƒ½åŸºäºéä»£ç å‚æ•°è€Œå˜åŒ–ã€‚

    ---

    ## å…³é”®è¦ç‚¹

    ğŸ¯ **å¯é‡ç°æ€§çš„æ ¸å¿ƒä»·å€¼**ï¼š

    - å»ºç«‹å¯¹MLç³»ç»Ÿçš„ä¿¡ä»»
    - ç®€åŒ–è°ƒè¯•å’Œé—®é¢˜è¿½è¸ª
    - ä¿ƒè¿›å›¢é˜Ÿåä½œ
    - æ»¡è¶³åˆè§„å’Œå®¡è®¡è¦æ±‚

    ğŸ”§ **å®ç°å¯é‡ç°æ€§çš„å·¥å…·é“¾**ï¼š

    - **Git**: ä»£ç ç‰ˆæœ¬æ§åˆ¶
    - **DVC**: æ•°æ®å’Œæ¨¡å‹ç‰ˆæœ¬æ§åˆ¶
    - **MLflow**: å®éªŒè·Ÿè¸ªå’Œæ¨¡å‹æ³¨å†Œ
    - **Docker**: ç¯å¢ƒç‰ˆæœ¬æ§åˆ¶

    ğŸ“‹ **æœ€ä½³å®è·µæ£€æŸ¥æ¸…å•**ï¼š

    - âœ… è®¾ç½®éšæœºç§å­
    - âœ… ç‰ˆæœ¬æ§åˆ¶æ‰€æœ‰ä»£ç 
    - âœ… è·Ÿè¸ªæ•°æ®ç‰ˆæœ¬
    - âœ… è®°å½•å®éªŒå‚æ•°å’ŒæŒ‡æ ‡
    - âœ… ä¿å­˜æ¨¡å‹å·¥ä»¶å’Œå…ƒæ•°æ®
    - âœ… ç®¡ç†ç¯å¢ƒä¾èµ–
    - âœ… æµ‹è¯•å¯é‡ç°æ€§

    ğŸ’¡ **è®°ä½**ï¼šå¯é‡ç°æ€§ä¸æ˜¯å¼€é”€ï¼Œè€Œæ˜¯æŠ•èµ„ã€‚å®ƒä¸ºæœªæ¥çš„ä½ å’Œä½ çš„å›¢é˜ŸèŠ‚çœæ—¶é—´ï¼Œå¹¶ä½¿MLä»è‰ºæœ¯è½¬å˜ä¸ºå·¥ç¨‹å­¦ç§‘ã€‚
    """
    )
    return


if __name__ == "__main__":
    app.run()
