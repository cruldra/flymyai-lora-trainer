import marimo

__generated_with = "0.16.2"
app = marimo.App(width="medium")


@app.cell(hide_code=True)
def _():
    import marimo as mo
    return (mo,)


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    # æ¨¡å‹å‹ç¼©ï¼šé«˜æ•ˆæœºå™¨å­¦ä¹ çš„å…³é”®æ­¥éª¤

    å››ç§å‡å°‘æ¨¡å‹å ç”¨ç©ºé—´å’Œæ¨ç†æ—¶é—´çš„å…³é”®æ–¹æ³•ã€‚
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## åŠ¨æœº

    è®­ç»ƒæœºå™¨å­¦ä¹ ï¼ˆMLï¼‰æ¨¡å‹ç»å¸¸è¢«è¿½æ±‚æ›´é«˜å‡†ç¡®ç‡çš„æ— æƒ…è¿½æ±‚æ‰€é©±åŠ¨ã€‚

    è®¸å¤šäººåˆ›å»ºè¶Šæ¥è¶Šå¤æ‚çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹åœ¨"æ€§èƒ½æ–¹é¢"æ— ç–‘è¡¨ç°å¾—éå¸¸å‡ºè‰²ã€‚

    ç„¶è€Œï¼Œå¤æ‚æ€§ä¸¥é‡å½±å“äº†å®ƒä»¬çš„ç°å®ä¸–ç•Œå®ç”¨æ€§ã€‚

    ![æ¨¡å‹å¤æ‚æ€§ä¸å®ç”¨æ€§](https://www.dailydoseofds.com/content/images/2023/09/image-133.png)

    **å¤šå¹´æ¥ï¼Œæ¨¡å‹å¼€å‘çš„ä¸»è¦ç›®æ ‡ä¸€ç›´æ˜¯å®ç°æœ€ä½³æ€§èƒ½æŒ‡æ ‡ã€‚**

    è¿™ç§åšæ³•ä¸å¹¸çš„æ˜¯ä¹Ÿè¢«è®¸å¤šåŸºäºæ’è¡Œæ¦œçš„ç«èµ›æ‰€æ¨å¹¿ã€‚è™½ç„¶æ²¡æœ‰é”™ï¼Œä½†åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™æ©ç›–äº†å…³æ³¨è§£å†³æ–¹æ¡ˆç°å®ä¸–ç•Œé€‚ç”¨æ€§çš„é‡è¦æ€§ã€‚

    ç„¶è€Œï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œå½“æ¶‰åŠåˆ°åœ¨ç”Ÿäº§ï¼ˆæˆ–é¢å‘ç”¨æˆ·ï¼‰ç³»ç»Ÿä¸­éƒ¨ç½²è¿™äº›æ¨¡å‹æ—¶ï¼Œç„¦ç‚¹ä»åŸå§‹å‡†ç¡®æ€§è½¬å‘æ•ˆç‡ã€é€Ÿåº¦å’Œèµ„æºæ¶ˆè€—ç­‰è€ƒè™‘å› ç´ ã€‚

    å› æ­¤ï¼Œé€šå¸¸å½“æˆ‘ä»¬å°†ä»»ä½•æ¨¡å‹éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒçš„ç‰¹å®šæ¨¡å‹å¹¶ä¸ä»…ä»…åŸºäºæ€§èƒ½æ¥ç¡®å®šã€‚

    ![éƒ¨ç½²è€ƒè™‘å› ç´ ](https://www.dailydoseofds.com/content/images/2023/09/image-134.png)

    ç›¸åï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘å‡ ä¸ªä¸MLæ— å…³çš„è¿è¥æŒ‡æ ‡ã€‚

    **å®ƒä»¬æ˜¯ä»€ä¹ˆï¼Ÿè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹ï¼**
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## å…¸å‹è¿è¥æŒ‡æ ‡

    å½“æ¨¡å‹éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œå¿…é¡»æ»¡è¶³æŸäº›è¦æ±‚ã€‚

    é€šå¸¸ï¼Œè¿™äº›"è¦æ±‚"åœ¨æ¨¡å‹çš„åŸå‹è®¾è®¡é˜¶æ®µä¸è¢«è€ƒè™‘ã€‚

    ä¾‹å¦‚ï¼Œå¯ä»¥åˆç†å‡è®¾é¢å‘ç”¨æˆ·çš„æ¨¡å‹å¯èƒ½å¿…é¡»å¤„ç†æ¥è‡ªæ¨¡å‹é›†æˆçš„äº§å“/æœåŠ¡çš„å¤§é‡è¯·æ±‚ã€‚

    å½“ç„¶ï¼Œæˆ‘ä»¬æ°¸è¿œä¸èƒ½è¦æ±‚ç”¨æˆ·ç­‰å¾…ï¼Œæ¯”å¦‚è¯´ï¼Œä¸€åˆ†é’Ÿè®©æ¨¡å‹è¿è¡Œå¹¶ç”Ÿæˆé¢„æµ‹ã€‚

    å› æ­¤ï¼Œé™¤äº†"æ¨¡å‹æ€§èƒ½"ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›ä¼˜åŒ–å‡ ä¸ªå…¶ä»–è¿è¥æŒ‡æ ‡ï¼š

    ### 1ï¼‰æ¨ç†å»¶è¿Ÿ

    è¿™æ˜¯æ¨¡å‹å¤„ç†å•ä¸ªè¾“å…¥å¹¶ç”Ÿæˆé¢„æµ‹æ‰€éœ€çš„æ—¶é—´ã€‚

    å®ƒæµ‹é‡å‘æ¨¡å‹å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”ä¹‹é—´çš„å»¶è¿Ÿã€‚

    ![æ¨ç†å»¶è¿Ÿ](https://www.dailydoseofds.com/content/images/2023/09/image-135.png)

    åŠªåŠ›å®ç°ä½æ¨ç†å»¶è¿Ÿå¯¹äºæ‰€æœ‰å®æ—¶æˆ–äº¤äº’å¼åº”ç”¨ç¨‹åºéƒ½è‡³å…³é‡è¦ï¼Œå› ä¸ºç”¨æˆ·æœŸæœ›å¿«é€Ÿå“åº”ã€‚

    æ­£å¦‚æ‚¨å¯èƒ½çŒœåˆ°çš„ï¼Œé«˜å»¶è¿Ÿå°†å¯¼è‡´ç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒï¼Œå¹¶ä¸”ä¸é€‚åˆè®¸å¤šåº”ç”¨ç¨‹åºï¼Œå¦‚ï¼š

    - èŠå¤©æœºå™¨äºº
    - å®æ—¶è¯­éŸ³è½¬æ–‡æœ¬è½¬å½•
    - æ¸¸æˆç­‰ç­‰

    ### 2ï¼‰ååé‡

    ååé‡æ˜¯æ¨¡å‹åœ¨ç»™å®šæ—¶é—´æ®µå†…å¯ä»¥å¤„ç†çš„æ¨ç†è¯·æ±‚æ•°é‡ã€‚

    å®ƒä¼°è®¡æ¨¡å‹åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚çš„èƒ½åŠ›ã€‚

    ![ååé‡](https://www.dailydoseofds.com/content/images/2023/09/image-136.png)

    å†æ¬¡ï¼Œæ­£å¦‚æ‚¨å¯èƒ½çŒœåˆ°çš„ï¼Œé«˜ååé‡å¯¹äºå…·æœ‰å¤§é‡ä¼ å…¥è¯·æ±‚çš„åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚

    è¿™äº›åŒ…æ‹¬ç”µå­å•†åŠ¡ç½‘ç«™ã€æ¨èç³»ç»Ÿã€ç¤¾äº¤åª’ä½“å¹³å°ç­‰ã€‚é«˜ååé‡ç¡®ä¿æ¨¡å‹å¯ä»¥åŒæ—¶ä¸ºè®¸å¤šç”¨æˆ·æä¾›æœåŠ¡ï¼Œè€Œä¸ä¼šå‡ºç°æ˜¾è‘—å»¶è¿Ÿã€‚

    ### 3ï¼‰æ¨¡å‹å¤§å°

    è¿™æŒ‡çš„æ˜¯æ¨¡å‹åœ¨åŠ è½½ç”¨äºæ¨ç†ç›®çš„æ—¶å ç”¨çš„å†…å­˜é‡ã€‚

    å®ƒé‡åŒ–äº†å­˜å‚¨æ¨¡å‹è¿›è¡Œé¢„æµ‹æˆ–ç”Ÿæˆå®æ—¶è¾“å‡ºæ‰€éœ€çš„æ‰€æœ‰å‚æ•°ã€é…ç½®å’Œç›¸å…³æ•°æ®æ‰€éœ€çš„å†…å­˜å ç”¨ã€‚

    ![æ¨¡å‹å¤§å°](https://www.dailydoseofds.com/content/images/2023/09/image-138.png)

    æ¨¡å‹å¤§å°çš„é‡è¦æ€§åœ¨èµ„æºå—é™ç¯å¢ƒä¸­éƒ¨ç½²æ¨¡å‹æ—¶å˜å¾—ç‰¹åˆ«æ˜æ˜¾ã€‚

    è®¸å¤šç”Ÿäº§ç¯å¢ƒï¼Œå¦‚ç§»åŠ¨è®¾å¤‡ã€è¾¹ç¼˜è®¾å¤‡æˆ–ç‰©è”ç½‘è®¾å¤‡ï¼Œå…·æœ‰æœ‰é™çš„å†…å­˜å®¹é‡ã€‚

    æ˜¾ç„¶å¯ä»¥çŒœæµ‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¨¡å‹çš„å¤§å°å°†ç›´æ¥å½±å“å®ƒæ˜¯å¦å¯ä»¥éƒ¨ç½²ã€‚

    ![èµ„æºå—é™ç¯å¢ƒ](https://www.dailydoseofds.com/content/images/2023/09/image-139.png)

    å¤§å‹æ¨¡å‹å¯èƒ½æ— æ³•é€‚åº”å¯ç”¨å†…å­˜ï¼Œä½¿å®ƒä»¬å¯¹è¿™äº›èµ„æºå—é™çš„è®¾ç½®ä¸åˆ‡å®é™…ã€‚
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## ç°å®æ¡ˆä¾‹

    è¿™æ˜¯ä¸€ä¸ªè‘—åçš„æ•…äº‹ã€‚

    2006å¹´ï¼ŒNetflixæ¨å‡ºäº†"Netflixå¥–"ï¼Œè¿™æ˜¯ä¸€ä¸ªæœºå™¨å­¦ä¹ ç«èµ›ï¼Œé¼“åŠ±MLå·¥ç¨‹å¸ˆæ„å»ºæœ€ä½³ç®—æ³•æ¥é¢„æµ‹ç”¨æˆ·å¯¹ç”µå½±çš„è¯„åˆ†ã€‚

    **å¤§å¥–æ˜¯100ä¸‡ç¾å…ƒã€‚**

    ç«èµ›ç»“æŸåï¼ŒNetflixåœ¨2009å¹´å‘ä¸€ä¸ªå¼€å‘å›¢é˜Ÿé¢å‘äº†100ä¸‡ç¾å…ƒå¥–é‡‘ï¼Œå› ä¸ºä»–ä»¬çš„ç®—æ³•å°†å…¬å¸æ¨èå¼•æ“çš„å‡†ç¡®æ€§æé«˜äº†**10%**ã€‚

    è¿™æ˜¯å¾ˆå¤šçš„ï¼

    ç„¶è€Œï¼ŒNetflixä»æœªä½¿ç”¨è¿‡è¯¥è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒè¿‡äºå¤æ‚ã€‚

    Netflixæ˜¯è¿™æ ·è¯´çš„ï¼š

    > è·èƒœæ”¹è¿›çš„å‡†ç¡®æ€§å¢åŠ ä¼¼ä¹ä¸è¶³ä»¥è¯æ˜å°†å®ƒä»¬å¸¦å…¥ç”Ÿäº§ç¯å¢ƒæ‰€éœ€çš„å·¥ç¨‹åŠªåŠ›æ˜¯åˆç†çš„ã€‚

    å¼€å‘æ¨¡å‹çš„å¤æ‚æ€§å’Œèµ„æºéœ€æ±‚ä½¿å…¶å¯¹ç°å®ä¸–ç•Œéƒ¨ç½²ä¸åˆ‡å®é™…ã€‚Netflixé¢ä¸´å‡ ä¸ªæŒ‘æˆ˜ï¼š

    1. **å¯æ‰©å±•æ€§ï¼š** è¯¥æ¨¡å‹ä¸å®¹æ˜“æ‰©å±•ä»¥å¤„ç†Netflixå¹³å°ä¸Šçš„å¤§é‡ç”¨æˆ·å’Œç”µå½±ã€‚å®ƒéœ€è¦å¤§é‡çš„è®¡ç®—èµ„æºæ¥ä¸ºä»–ä»¬æ‹¥æœ‰çš„æ•°ç™¾ä¸‡ç”¨æˆ·æä¾›å®æ—¶æ¨èã€‚
    2. **ç»´æŠ¤ï¼š** åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç®¡ç†å’Œæ›´æ–°å¦‚æ­¤å¤æ‚çš„æ¨¡å‹å°†æ˜¯ä¸€ä¸ªåå‹¤å™©æ¢¦ã€‚å¯¹æ¨¡å‹çš„é¢‘ç¹æ›´æ–°å’Œæ›´æ”¹å°†éš¾ä»¥å®æ–½å’Œç»´æŠ¤ã€‚
    3. **å»¶è¿Ÿï¼š** é›†æˆæ¨¡å‹çš„æ¨ç†å»¶è¿Ÿè¿œéæµåª’ä½“æœåŠ¡çš„ç†æƒ³é€‰æ‹©ã€‚ç”¨æˆ·æœŸæœ›è¿‘ä¹å³æ—¶çš„æ¨èï¼Œä½†æ¨¡å‹çš„å¤æ‚æ€§ä½¿å®ç°ä½å»¶è¿Ÿå˜å¾—å›°éš¾ã€‚

    > æ‚¨å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºè¿™ä¸ªæ•…äº‹çš„ä¿¡æ¯ï¼š[Netflixå¥–æ•…äº‹](https://www.wired.com/2012/04/netflix-prize-costs/?ref=dailydoseofds.com)ã€‚

    å› æ­¤ï¼ŒNetflixä»æœªå°†è·èƒœè§£å†³æ–¹æ¡ˆé›†æˆåˆ°å…¶ç”Ÿäº§æ¨èç³»ç»Ÿä¸­ã€‚ç›¸åï¼Œä»–ä»¬ç»§ç»­ä½¿ç”¨ç°æœ‰ç®—æ³•çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œè¿™å¯¹å®æ—¶æ¨èæ›´å®ç”¨ã€‚

    Netflixå¥–çš„è¿™ä¸ªç°å®æ¡ˆä¾‹æé†’æˆ‘ä»¬ï¼Œæˆ‘ä»¬å¿…é¡»åŠªåŠ›åœ¨æ¨¡å‹å¤æ‚æ€§å’Œå®é™…æ•ˆç”¨ä¹‹é—´å–å¾—å¾®å¦™çš„å¹³è¡¡ã€‚

    ---

    **è™½ç„¶é«˜åº¦å¤æ‚çš„æ¨¡å‹å¯èƒ½åœ¨ç ”ç©¶å’Œç«èµ›ç¯å¢ƒä¸­è¡¨ç°å‡ºè‰²ï¼Œä½†ç”±äºå¯æ‰©å±•æ€§ã€ç»´æŠ¤å’Œå»¶è¿Ÿé—®é¢˜ï¼Œå®ƒä»¬å¯èƒ½ä¸é€‚åˆç°å®ä¸–ç•Œçš„éƒ¨ç½²ã€‚**

    åœ¨å®è·µä¸­ï¼Œæ›´ç®€å•ã€æ›´é«˜æ•ˆçš„æ¨¡å‹é€šå¸¸æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æä¾›æ— ç¼ç”¨æˆ·ä½“éªŒçš„æ›´å¥½é€‰æ‹©ã€‚

    è®©æˆ‘é—®ä½ è¿™ä¸ªã€‚ä»¥ä¸‹ä¸¤ä¸ªæ¨¡å‹ä¸­ï¼Œä½ æ›´æ„¿æ„å°†å“ªä¸ªé›†æˆåˆ°é¢å‘ç”¨æˆ·çš„äº§å“ä¸­ï¼Ÿ

    ![æ¨¡å‹é€‰æ‹©](https://www.dailydoseofds.com/content/images/2023/09/image-141.png)

    æˆ‘å¼ºçƒˆåå¥½æ¨¡å‹Bã€‚

    å¦‚æœä½ ç†è§£è¿™ä¸€ç‚¹ï¼Œä½ å°±ä¸åœ¨ç”Ÿäº§ä¸­ä¿æŒç®€å•çš„æƒ³æ³•äº§ç”Ÿå…±é¸£ã€‚

    å¹¸è¿çš„æ˜¯ï¼Œæœ‰å„ç§æŠ€æœ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‡å°‘æ¨¡å‹çš„å¤§å°ï¼Œä»è€Œæé«˜æ¨¡å‹æ¨ç†çš„é€Ÿåº¦ã€‚

    è¿™äº›æŠ€æœ¯è¢«ç§°ä¸º**æ¨¡å‹å‹ç¼©**æ–¹æ³•ã€‚

    ä½¿ç”¨è¿™äº›æŠ€æœ¯ï¼Œæ‚¨å¯ä»¥å‡å°‘åŸå§‹æ¨¡å‹çš„å»¶è¿Ÿå’Œå¤§å°ã€‚
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## æ¨¡å‹å‹ç¼©

    é¡¾åæ€ä¹‰ï¼Œæ¨¡å‹å‹ç¼©æ˜¯ä¸€ç»„ç”¨äºå‡å°‘æ¨¡å‹å¤§å°å’Œè®¡ç®—å¤æ‚æ€§åŒæ—¶ä¿æŒæˆ–ç”šè‡³æ”¹å–„å…¶æ€§èƒ½çš„æŠ€æœ¯ã€‚

    ![æ¨¡å‹å‹ç¼©](https://www.dailydoseofds.com/content/images/2023/09/image-142.png)

    å®ƒä»¬æ—¨åœ¨ä½¿æ¨¡å‹æ›´å°â€”â€”è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåç§°æ˜¯"**æ¨¡å‹å‹ç¼©**"ã€‚

    é€šå¸¸ï¼Œé¢„æœŸè¾ƒå°çš„æ¨¡å‹å°†ï¼š

    - å…·æœ‰è¾ƒä½çš„æ¨ç†å»¶è¿Ÿï¼Œå› ä¸ºè¾ƒå°çš„æ¨¡å‹å¯ä»¥æä¾›æ›´å¿«çš„é¢„æµ‹ï¼Œä½¿å®ƒä»¬éå¸¸é€‚åˆå®æ—¶æˆ–ä½å»¶è¿Ÿåº”ç”¨ç¨‹åºã€‚
    - ç”±äºå…¶å‡å°‘çš„è®¡ç®—éœ€æ±‚è€Œæ˜“äºæ‰©å±•ã€‚
    - å…·æœ‰è¾ƒå°çš„å†…å­˜å ç”¨ã€‚

    åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹å››ç§å¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸€ç›®æ ‡çš„æŠ€æœ¯ï¼š

    ![æ¨¡å‹å‹ç¼©æŠ€æœ¯](https://www.dailydoseofds.com/content/images/2023/09/image-143.png)

    1. çŸ¥è¯†è’¸é¦
    2. å‰ªæ
    3. ä½ç§©åˆ†è§£
    4. é‡åŒ–

    æ­£å¦‚æˆ‘ä»¬å¾ˆå¿«å°†çœ‹åˆ°çš„ï¼Œè¿™äº›æŠ€æœ¯è¯•å›¾åœ¨æ¨¡å‹å¤§å°å’Œå‡†ç¡®æ€§ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œä½¿åœ¨é¢å‘ç”¨æˆ·çš„äº§å“ä¸­éƒ¨ç½²æ¨¡å‹ç›¸å¯¹æ›´å®¹æ˜“ã€‚

    è®©æˆ‘ä»¬é€ä¸€äº†è§£å®ƒä»¬ï¼
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## çŸ¥è¯†è’¸é¦

    è¿™æ˜¯å‡å°‘æ¨¡å‹å¤§å°æœ€å¸¸è§ã€æœ‰æ•ˆã€å¯é å’Œæˆ‘æœ€å–œæ¬¢çš„æŠ€æœ¯ä¹‹ä¸€ã€‚

    æœ¬è´¨ä¸Šï¼ŒçŸ¥è¯†è’¸é¦æ¶‰åŠè®­ç»ƒä¸€ä¸ªè¾ƒå°ã€æ›´ç®€å•çš„æ¨¡å‹ï¼ˆç§°ä¸º"å­¦ç”Ÿ"æ¨¡å‹ï¼‰æ¥æ¨¡ä»¿è¾ƒå¤§ã€æ›´å¤æ‚æ¨¡å‹ï¼ˆç§°ä¸º"æ•™å¸ˆ"æ¨¡å‹ï¼‰çš„è¡Œä¸ºã€‚

    è¯¥æœ¯è¯­å¯ä»¥åˆ†è§£å¦‚ä¸‹ï¼š

    - **çŸ¥è¯†ï¼š** æŒ‡æœºå™¨å­¦ä¹ æ¨¡å‹åœ¨è®­ç»ƒæœŸé—´è·å¾—çš„ç†è§£ã€æ´å¯Ÿæˆ–ä¿¡æ¯ã€‚è¿™ç§"çŸ¥è¯†"é€šå¸¸å¯ä»¥ç”±æ¨¡å‹çš„å‚æ•°ã€å­¦ä¹ çš„æ¨¡å¼å’Œå…¶è¿›è¡Œé¢„æµ‹çš„èƒ½åŠ›æ¥è¡¨ç¤ºã€‚

    ![ç¥ç»ç½‘ç»œçš„çŸ¥è¯†](https://www.dailydoseofds.com/content/images/2023/09/image-67.png)

    - **è’¸é¦ï¼š** åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè’¸é¦æ„å‘³ç€å°†çŸ¥è¯†ä»ä¸€ä¸ªæ¨¡å‹è½¬ç§»æˆ–æµ“ç¼©åˆ°å¦ä¸€ä¸ªæ¨¡å‹ã€‚å®ƒæ¶‰åŠè®­ç»ƒå­¦ç”Ÿæ¨¡å‹æ¥æ¨¡ä»¿æ•™å¸ˆæ¨¡å‹çš„è¡Œä¸ºï¼Œæœ‰æ•ˆåœ°è½¬ç§»æ•™å¸ˆçš„çŸ¥è¯†ã€‚

    ![çŸ¥è¯†è’¸é¦è¿‡ç¨‹](https://www.dailydoseofds.com/content/images/2023/09/image-68.png)

    è¿™æ˜¯ä¸€ä¸ªä¸¤æ­¥è¿‡ç¨‹ï¼š

    - åƒé€šå¸¸é‚£æ ·è®­ç»ƒå¤§æ¨¡å‹ã€‚è¿™è¢«ç§°ä¸º"æ•™å¸ˆ"æ¨¡å‹ã€‚
    - è®­ç»ƒä¸€ä¸ªè¾ƒå°çš„æ¨¡å‹ï¼Œæ—¨åœ¨æ¨¡ä»¿è¾ƒå¤§æ¨¡å‹çš„è¡Œä¸ºã€‚è¿™ä¹Ÿè¢«ç§°ä¸º"å­¦ç”Ÿ"æ¨¡å‹ã€‚

    ![æ•™å¸ˆå­¦ç”Ÿæ¨¡å‹](https://www.dailydoseofds.com/content/images/2023/09/image-144.png)

    çŸ¥è¯†è’¸é¦çš„ä¸»è¦ç›®æ ‡æ˜¯å°†çŸ¥è¯†æˆ–å­¦ä¹ çš„æ´å¯Ÿä»æ•™å¸ˆè½¬ç§»åˆ°å­¦ç”Ÿæ¨¡å‹ã€‚

    è¿™å…è®¸å­¦ç”Ÿæ¨¡å‹ä»¥æ›´å°‘çš„å‚æ•°å’Œé™ä½çš„è®¡ç®—å¤æ‚æ€§å®ç°å¯æ¯”è¾ƒçš„æ€§èƒ½ã€‚

    è¯¥æŠ€æœ¯ä¹Ÿå¾ˆç›´è§‚ã€‚

    å½“ç„¶ï¼Œå°†å…¶ä¸å­¦æœ¯ç¯å¢ƒä¸­çš„ç°å®ä¸–ç•Œå¸ˆç”Ÿåœºæ™¯è¿›è¡Œæ¯”è¾ƒï¼Œå­¦ç”Ÿæ¨¡å‹å¯èƒ½æ°¸è¿œä¸ä¼šè¡¨ç°å¾—åƒæ•™å¸ˆæ¨¡å‹é‚£æ ·å¥½ã€‚

    ä½†é€šè¿‡æŒç»­çš„è®­ç»ƒï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª**å‡ ä¹**ä¸è¾ƒå¤§æ¨¡å‹ä¸€æ ·å¥½çš„è¾ƒå°æ¨¡å‹ã€‚

    è¿™å›åˆ°äº†æˆ‘ä»¬ä¸Šé¢è®¨è®ºçš„ç›®æ ‡ï¼š

    > åœ¨æ¨¡å‹å¤§å°å’Œå‡†ç¡®æ€§ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œä½¿åœ¨é¢å‘ç”¨æˆ·çš„äº§å“ä¸­éƒ¨ç½²æ¨¡å‹ç›¸å¯¹æ›´å®¹æ˜“ã€‚

    ä»¥è¿™ç§æ–¹å¼å¼€å‘çš„æ¨¡å‹çš„ç»å…¸ä¾‹å­æ˜¯[DistillBERT](https://huggingface.co/docs/transformers/model_doc/distilbert?ref=dailydoseofds.com)ã€‚å®ƒæ˜¯[BERT](https://arxiv.org/abs/1810.04805?ref=dailydoseofds.com)çš„å­¦ç”Ÿæ¨¡å‹ã€‚

    DistillBERTæ¯”BERTå°çº¦40%ï¼Œè¿™åœ¨å¤§å°ä¸Šæ˜¯å·¨å¤§çš„å·®å¼‚ã€‚

    å°½ç®¡å¦‚æ­¤ï¼Œå®ƒä¿ç•™äº†BERTçº¦97%çš„è‡ªç„¶è¯­è¨€ç†è§£ï¼ˆNLUï¼‰èƒ½åŠ›ã€‚

    **æ›´é‡è¦çš„æ˜¯ï¼ŒDistillBERTåœ¨æ¨ç†ä¸­å¤§çº¦å¿«60%ã€‚**

    è¿™æ˜¯æˆ‘åœ¨Transformeræ¨¡å‹çš„ä¸€é¡¹ç ”ç©¶ä¸­äº²èº«ä½“éªŒå’ŒéªŒè¯çš„ï¼š

    ![ç ”ç©¶ç»“æœ](https://www.dailydoseofds.com/content/images/2023/09/Screenshot-2023-09-13-at-12.40.42-PM.png)

    å¦‚ä¸Šæ‰€ç¤ºï¼Œåœ¨å…¶ä¸­ä¸€ä¸ªç ”ç©¶æ•°æ®é›†ï¼ˆSensEval-2ï¼‰ä¸Šï¼ŒBERTè¾¾åˆ°äº†76.81çš„æœ€ä½³å‡†ç¡®ç‡ã€‚ä½¿ç”¨DistilBERTï¼Œå‡†ç¡®ç‡ä¸º75.64ã€‚

    åœ¨å¦ä¸€ä¸ªä»»åŠ¡ï¼ˆSensEval-3ï¼‰ä¸Šï¼ŒBERTè¾¾åˆ°äº†80.96çš„æœ€ä½³å‡†ç¡®ç‡ã€‚ä½¿ç”¨DistilBERTï¼Œå‡†ç¡®ç‡ä¸º80.23ã€‚

    å½“ç„¶ï¼ŒDistilBERTä¸å¦‚BERTå¥½ã€‚ç„¶è€Œï¼Œæ€§èƒ½å·®å¼‚å¾ˆå°ã€‚

    è€ƒè™‘åˆ°è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŠ¿ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨DistilBERTè€Œä¸æ˜¯BERTæ›´æœ‰æ„ä¹‰ã€‚

    ğŸ’¡ å¦‚æœæ‚¨æœ‰å…´è¶£äº†è§£æ›´å¤šå…³äºæˆ‘çš„ç ”ç©¶ï¼Œå¯ä»¥åœ¨è¿™é‡Œé˜…è¯»ï¼š[Transformeråœ¨è¯ä¹‰æ¶ˆæ­§ä¸Šçš„æ¯”è¾ƒç ”ç©¶](https://arxiv.org/pdf/2111.15417.pdf?ref=dailydoseofds.com)ã€‚

    çŸ¥è¯†è’¸é¦çš„æœ€å¤§ç¼ºç‚¹ä¹‹ä¸€æ˜¯å¿…é¡»é¦–å…ˆè®­ç»ƒä¸€ä¸ªè¾ƒå¤§çš„æ•™å¸ˆæ¨¡å‹æ¥è®­ç»ƒå­¦ç”Ÿæ¨¡å‹ã€‚

    ç„¶è€Œï¼Œåœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­ï¼Œè®­ç»ƒå¤§å‹æ•™å¸ˆæ¨¡å‹å¯èƒ½ä¸å¯è¡Œã€‚

    å‡è®¾æˆ‘ä»¬è‡³å°‘åœ¨å¼€å‘ç¯å¢ƒä¸­ä¸å—èµ„æºé™åˆ¶ï¼ŒçŸ¥è¯†è’¸é¦æœ€å¸¸è§çš„æŠ€æœ¯ä¹‹ä¸€æ˜¯**åŸºäºå“åº”çš„çŸ¥è¯†è’¸é¦**ã€‚

    é¡¾åæ€ä¹‰ï¼Œåœ¨**åŸºäºå“åº”çš„çŸ¥è¯†è’¸é¦**ä¸­ï¼Œé‡ç‚¹æ˜¯åŒ¹é…æ•™å¸ˆæ¨¡å‹å’Œå­¦ç”Ÿæ¨¡å‹çš„è¾“å‡ºå“åº”ï¼ˆé¢„æµ‹ï¼‰ã€‚

    ![åŸºäºå“åº”çš„çŸ¥è¯†è’¸é¦](https://www.dailydoseofds.com/content/images/2023/09/image-149.png)

    è°ˆåˆ°åˆ†ç±»ç”¨ä¾‹ï¼Œè¿™ç§æŠ€æœ¯å°†ç±»é¢„æµ‹çš„**æ¦‚ç‡åˆ†å¸ƒ**ä»æ•™å¸ˆè½¬ç§»åˆ°å­¦ç”Ÿã€‚

    å®ƒæ¶‰åŠè®­ç»ƒå­¦ç”Ÿä¸ä»…äº§ç”Ÿå‡†ç¡®çš„é¢„æµ‹ï¼Œè€Œä¸”æ¨¡ä»¿æ•™å¸ˆæ¨¡å‹çš„è½¯é¢„æµ‹ï¼ˆæ¦‚ç‡åˆ†æ•°ï¼‰ã€‚

    ç”±äºæˆ‘ä»¬è¯•å›¾æ¨¡ä»¿**æ•™å¸ˆæ¨¡å‹çš„ç±»é¢„æµ‹çš„æ¦‚ç‡åˆ†å¸ƒ**ï¼ŒæŸå¤±å‡½æ•°çš„ç†æƒ³å€™é€‰è€…æ˜¯KLæ•£åº¦ã€‚

    æˆ‘ä»¬åœ¨ä¹‹å‰å…³äºt-SNEçš„æ–‡ç« ä¸­è¯¦ç»†è®¨è®ºäº†è¿™ä¸€ç‚¹ã€‚

    ç„¶è€Œï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¿«é€Ÿå›é¡¾ï¼š
    [Formulating and Implementing the t-SNE Algorithm From Scratch](https://www.dailydoseofds.com/formulating-and-implementing-the-t-sne-algorithm-from-scratch/)
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ### KLæ•£åº¦

    KLæ•£åº¦èƒŒåçš„æ ¸å¿ƒæ€æƒ³æ˜¯è¯„ä¼°å½“ä¸€ä¸ªåˆ†å¸ƒç”¨äºè¿‘ä¼¼å¦ä¸€ä¸ªåˆ†å¸ƒæ—¶ä¸¢å¤±äº†å¤šå°‘ä¿¡æ¯ã€‚

    å› æ­¤ï¼Œä¸¢å¤±çš„ä¿¡æ¯è¶Šå¤šï¼ŒKLæ•£åº¦è¶Šå¤§ã€‚ç»“æœï¼Œå·®å¼‚æ€§è¶Šå¤§ã€‚

    ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒP(x)å’ŒQ(x)ä¹‹é—´çš„KLæ•£åº¦è®¡ç®—å¦‚ä¸‹ï¼š

    ![KLæ•£åº¦å…¬å¼](https://www.dailydoseofds.com/content/images/2023/08/image-531.png)

    KLæ•£åº¦å…¬å¼å¯ä»¥è¿™æ ·ç†è§£ï¼š

    KLæ•£åº¦DKL(P||Q)æµ‹é‡å½“ä½¿ç”¨åˆ†å¸ƒQæ¥è¿‘ä¼¼Pæ—¶ä¸¢å¤±äº†å¤šå°‘ä¿¡æ¯ã€‚

    æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ¦‚ç‡åˆ†å¸ƒPå’ŒQå¯¹äºæ‰€æœ‰xéƒ½ç›¸åŒï¼Œå³P(x) = Q(x)ï¼Œé‚£ä¹ˆï¼š

    ![KLæ•£åº¦ä¸º0çš„æƒ…å†µ](https://www.dailydoseofds.com/content/images/2023/08/image-532.png)

    ç®€åŒ–åï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š

    ![ç®€åŒ–ç»“æœ](https://www.dailydoseofds.com/content/images/2023/08/image-533.png)

    è¿™æ­£æ˜¯æˆ‘ä»¬åœ¨åŸºäºå“åº”çš„çŸ¥è¯†è’¸é¦ä¸­æ‰“ç®—å®ç°çš„ã€‚

    ç®€å•åœ°è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›å­¦ç”Ÿæ¨¡å‹çš„ç±»é¢„æµ‹çš„æ¦‚ç‡åˆ†å¸ƒä¸æ•™å¸ˆæ¨¡å‹çš„ç±»é¢„æµ‹çš„æ¦‚ç‡åˆ†å¸ƒç›¸åŒã€‚

    - é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥åƒé€šå¸¸é‚£æ ·è®­ç»ƒæ•™å¸ˆæ¨¡å‹ã€‚
    - æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡ç¤ºå­¦ç”Ÿæ¨¡å‹æ¨¡ä»¿æ•™å¸ˆæ¨¡å‹çš„ç±»é¢„æµ‹çš„æ¦‚ç‡åˆ†å¸ƒã€‚

    è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨PyTorchå®é™…ä½¿ç”¨åŸºäºå“åº”çš„çŸ¥è¯†è’¸é¦ã€‚

    æ›´å…·ä½“åœ°è¯´ï¼Œæˆ‘ä»¬å°†åœ¨MNISTæ•°æ®é›†ä¸Šè®­ç»ƒä¸€ä¸ªç¨å¾®å¤æ‚çš„ç¥ç»ç½‘ç»œã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŸºäºå“åº”çš„çŸ¥è¯†è’¸é¦æŠ€æœ¯æ„å»ºä¸€ä¸ªæ›´ç®€å•çš„ç¥ç»ç½‘ç»œã€‚
    """
    )
    return


@app.cell
def _():
    # å¯¼å…¥å¿…è¦çš„åº“
    import time

    import numpy as np
    import torch
    import torch.nn as nn
    import torch.nn.functional as F
    import torch.optim as optim
    from torch.utils.data import DataLoader
    from torchvision import datasets, transforms

    print("å¯¼å…¥å®Œæˆ")
    return DataLoader, F, datasets, nn, optim, torch, transforms


@app.cell
def _(DataLoader, datasets, transforms):
    # åŠ è½½MNISTæ•°æ®é›†
    transform = transforms.Compose([
        transforms.ToTensor(),
        transforms.Normalize((0.1307,), (0.3081,))
    ])

    train_dataset = datasets.MNIST('./data', train=True, download=True, transform=transform)
    test_dataset = datasets.MNIST('./data', train=False, transform=transform)

    train_loader = DataLoader(train_dataset, batch_size=64, shuffle=True)
    test_loader = DataLoader(test_dataset, batch_size=1000, shuffle=False)

    print(f"è®­ç»ƒé›†å¤§å°: {len(train_dataset)}")
    print(f"æµ‹è¯•é›†å¤§å°: {len(test_dataset)}")
    return test_loader, train_loader


@app.cell
def _(nn, torch):
    # å®šä¹‰æ•™å¸ˆæ¨¡å‹ï¼ˆCNNï¼‰
    class TeacherModel(nn.Module):
        def __init__(self):
            super(TeacherModel, self).__init__()
            self.conv1 = nn.Conv2d(1, 32, 3, 1)
            self.conv2 = nn.Conv2d(32, 64, 3, 1)
            self.dropout1 = nn.Dropout2d(0.25)
            self.dropout2 = nn.Dropout2d(0.5)
            self.fc1 = nn.Linear(9216, 128)
            self.fc2 = nn.Linear(128, 10)

        def forward(self, x):
            x = self.conv1(x)
            x = nn.functional.relu(x)
            x = self.conv2(x)
            x = nn.functional.relu(x)
            x = nn.functional.max_pool2d(x, 2)
            x = self.dropout1(x)
            x = torch.flatten(x, 1)
            x = self.fc1(x)
            x = nn.functional.relu(x)
            x = self.dropout2(x)
            x = self.fc2(x)
            return x

    print("æ•™å¸ˆæ¨¡å‹å®šä¹‰å®Œæˆ")
    return (TeacherModel,)


@app.cell
def _(TeacherModel, nn, optim, torch):
    # åˆå§‹åŒ–æ•™å¸ˆæ¨¡å‹
    teacher_model = TeacherModel()
    teacher_criterion = nn.CrossEntropyLoss()
    teacher_optimizer = optim.Adam(teacher_model.parameters(), lr=0.001)

    # æ£€æŸ¥æ˜¯å¦æœ‰GPUå¯ç”¨
    device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
    teacher_model.to(device)

    print(f"ä½¿ç”¨è®¾å¤‡: {device}")
    print("æ•™å¸ˆæ¨¡å‹åˆå§‹åŒ–å®Œæˆ")
    return device, teacher_criterion, teacher_model, teacher_optimizer


@app.cell
def _(
    device,
    teacher_criterion,
    teacher_model,
    teacher_optimizer,
    train_loader,
):
    # è®­ç»ƒæ•™å¸ˆæ¨¡å‹
    def train_teacher_model(model, train_loader, criterion, optimizer, epochs=5):
        model.train()
        for epoch in range(epochs):
            running_loss = 0.0
            for batch_idx, (data, target) in enumerate(train_loader):
                data, target = data.to(device), target.to(device)
                optimizer.zero_grad()
                output = model(data)
                loss = criterion(output, target)
                loss.backward()
                optimizer.step()
                running_loss += loss.item()

                if batch_idx % 100 == 0:
                    print(f'è®­ç»ƒè½®æ¬¡: {epoch+1}/{epochs}, æ‰¹æ¬¡: {batch_idx}, æŸå¤±: {loss.item():.6f}')

            print(f'è½®æ¬¡ {epoch+1} å¹³å‡æŸå¤±: {running_loss/len(train_loader):.6f}')

    # è®­ç»ƒæ•™å¸ˆæ¨¡å‹
    print("å¼€å§‹è®­ç»ƒæ•™å¸ˆæ¨¡å‹...")
    train_teacher_model(teacher_model, train_loader, teacher_criterion, teacher_optimizer)
    print("æ•™å¸ˆæ¨¡å‹è®­ç»ƒå®Œæˆ")
    return


@app.cell(hide_code=True)
def _(device, teacher_model, test_loader, torch):
    # è¯„ä¼°æ•™å¸ˆæ¨¡å‹
    def evaluate_model(model, test_loader):
        model.eval()
        correct = 0
        total = 0
        with torch.no_grad():
            for data, target in test_loader:
                data, target = data.to(device), target.to(device)
                output = model(data)
                _, predicted = torch.max(output.data, 1)
                total += target.size(0)
                correct += (predicted == target).sum().item()

        accuracy = 100 * correct / total
        return accuracy

    teacher_accuracy = evaluate_model(teacher_model, test_loader)
    print(f"æ•™å¸ˆæ¨¡å‹å‡†ç¡®ç‡: {teacher_accuracy:.2f}%")
    return evaluate_model, teacher_accuracy


@app.cell
def _(nn):
    # å®šä¹‰å­¦ç”Ÿæ¨¡å‹ï¼ˆç®€å•çš„å‰é¦ˆç½‘ç»œï¼‰
    class StudentModel(nn.Module):
        def __init__(self):
            super(StudentModel, self).__init__()
            self.fc1 = nn.Linear(28*28, 128)
            self.fc2 = nn.Linear(128, 64)
            self.fc3 = nn.Linear(64, 10)
            self.dropout = nn.Dropout(0.2)

        def forward(self, x):
            x = x.view(-1, 28*28)  # å±•å¹³è¾“å…¥
            x = nn.functional.relu(self.fc1(x))
            x = self.dropout(x)
            x = nn.functional.relu(self.fc2(x))
            x = self.dropout(x)
            x = self.fc3(x)
            return x

    print("å­¦ç”Ÿæ¨¡å‹å®šä¹‰å®Œæˆ")
    return (StudentModel,)


@app.cell
def _(F):
    # å®šä¹‰KLæ•£åº¦æŸå¤±å‡½æ•°
    def kl_divergence_loss(student_logits, teacher_logits, temperature=3.0):
        """
        è®¡ç®—å­¦ç”Ÿæ¨¡å‹å’Œæ•™å¸ˆæ¨¡å‹è¾“å‡ºä¹‹é—´çš„KLæ•£åº¦

        Args:
            student_logits: å­¦ç”Ÿæ¨¡å‹çš„è¾“å‡º
            teacher_logits: æ•™å¸ˆæ¨¡å‹çš„è¾“å‡º
            temperature: æ¸©åº¦å‚æ•°ï¼Œç”¨äºè½¯åŒ–æ¦‚ç‡åˆ†å¸ƒ
        """
        # ä½¿ç”¨æ¸©åº¦å‚æ•°è½¯åŒ–logits
        student_probs = F.log_softmax(student_logits / temperature, dim=1)
        teacher_probs = F.softmax(teacher_logits / temperature, dim=1)

        # è®¡ç®—KLæ•£åº¦
        kl_div = F.kl_div(student_probs, teacher_probs, reduction='batchmean')

        return kl_div * (temperature ** 2)

    print("KLæ•£åº¦æŸå¤±å‡½æ•°å®šä¹‰å®Œæˆ")
    return (kl_divergence_loss,)


@app.cell
def _(StudentModel, device, optim):
    # åˆå§‹åŒ–å­¦ç”Ÿæ¨¡å‹
    student_model = StudentModel()
    student_model.to(device)
    student_optimizer = optim.Adam(student_model.parameters(), lr=0.001)

    print("å­¦ç”Ÿæ¨¡å‹åˆå§‹åŒ–å®Œæˆ")
    return student_model, student_optimizer


@app.cell
def _(
    device,
    kl_divergence_loss,
    student_model,
    student_optimizer,
    teacher_model,
    torch,
    train_loader,
):
    # è®­ç»ƒå­¦ç”Ÿæ¨¡å‹ï¼ˆçŸ¥è¯†è’¸é¦ï¼‰
    def train_student_model(student, teacher, train_loader, optimizer, epochs=5):
        student.train()
        teacher.eval()  # æ•™å¸ˆæ¨¡å‹è®¾ä¸ºè¯„ä¼°æ¨¡å¼

        for epoch in range(epochs):
            running_loss = 0.0
            for batch_idx, (data, target) in enumerate(train_loader):
                data, target = data.to(device), target.to(device)

                optimizer.zero_grad()

                # è·å–å­¦ç”Ÿå’Œæ•™å¸ˆçš„è¾“å‡º
                student_output = student(data)
                with torch.no_grad():
                    teacher_output = teacher(data)

                # è®¡ç®—KLæ•£åº¦æŸå¤±
                loss = kl_divergence_loss(student_output, teacher_output)

                loss.backward()
                optimizer.step()
                running_loss += loss.item()

                if batch_idx % 100 == 0:
                    print(f'è’¸é¦è®­ç»ƒè½®æ¬¡: {epoch+1}/{epochs}, æ‰¹æ¬¡: {batch_idx}, æŸå¤±: {loss.item():.6f}')

            print(f'è’¸é¦è½®æ¬¡ {epoch+1} å¹³å‡æŸå¤±: {running_loss/len(train_loader):.6f}')

    # è®­ç»ƒå­¦ç”Ÿæ¨¡å‹
    print("å¼€å§‹çŸ¥è¯†è’¸é¦è®­ç»ƒ...")
    train_student_model(student_model, teacher_model, train_loader, student_optimizer)
    print("å­¦ç”Ÿæ¨¡å‹è®­ç»ƒå®Œæˆ")
    return


@app.cell
def _(evaluate_model, student_model, test_loader):
    # è¯„ä¼°å­¦ç”Ÿæ¨¡å‹
    student_accuracy = evaluate_model(student_model, test_loader)
    print(f"å­¦ç”Ÿæ¨¡å‹å‡†ç¡®ç‡: {student_accuracy:.2f}%")
    return (student_accuracy,)


@app.cell(hide_code=True)
def _(mo, student_accuracy, teacher_accuracy):
    mo.md(
        f"""
    ### æ€§èƒ½æ¯”è¾ƒ â€” æ•™å¸ˆå’Œå­¦ç”Ÿæ¨¡å‹

    æ€»ç»“ä¸€ä¸‹ï¼Œæ•™å¸ˆæ¨¡å‹æ˜¯åŸºäºCNNçš„ç¥ç»ç½‘ç»œæ¶æ„ã€‚ç„¶è€Œï¼Œå­¦ç”Ÿæ¨¡å‹æ˜¯ä¸€ä¸ªç®€å•çš„å‰é¦ˆç¥ç»ç½‘ç»œã€‚

    **æ€§èƒ½å¯¹æ¯”ç»“æœï¼š**

    - **æ•™å¸ˆæ¨¡å‹å‡†ç¡®ç‡ï¼š** {teacher_accuracy:.2f}%
    - **å­¦ç”Ÿæ¨¡å‹å‡†ç¡®ç‡ï¼š** {student_accuracy:.2f}%

    å½“ç„¶ï¼Œå­¦ç”Ÿæ¨¡å‹çš„æ€§èƒ½ä¸å¦‚æ•™å¸ˆæ¨¡å‹ï¼Œè¿™æ˜¯é¢„æœŸçš„ã€‚ç„¶è€Œï¼Œè€ƒè™‘åˆ°å®ƒåªç”±ç®€å•çš„å‰é¦ˆå±‚ç»„æˆï¼Œå®ƒä»ç„¶éå¸¸æ¥è¿‘ã€‚

    è¿™å°±æ˜¯åŸºäºå“åº”çš„çŸ¥è¯†è’¸é¦çš„å·¥ä½œåŸç†ã€‚

    å­¦ç”Ÿæ¨¡å‹å¤§çº¦å¿«35%ã€‚

    è¿™å°±æ˜¯åŸºäºå“åº”çš„çŸ¥è¯†è’¸é¦çš„å·¥ä½œåŸç†ã€‚

    æ€»ç»“ï¼š

    - é¦–å…ˆï¼Œæˆ‘ä»¬åƒé€šå¸¸é‚£æ ·è®­ç»ƒå¤§å‹ï¼ˆæ•™å¸ˆï¼‰æ¨¡å‹ã€‚
    - æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®­ç»ƒä¸€ä¸ªè¾ƒå°çš„ï¼ˆå­¦ç”Ÿï¼‰æ¨¡å‹ï¼Œç›®æ ‡æ˜¯æ¨¡ä»¿æ•™å¸ˆæ¨¡å‹çš„ç±»é¢„æµ‹çš„æ¦‚ç‡åˆ†å¸ƒã€‚

    ![åŸºäºå“åº”çš„çŸ¥è¯†è’¸é¦æ€»ç»“](https://www.dailydoseofds.com/content/images/2023/09/image-148.png)

    åœ¨ä¸Šé¢çš„æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬çœ‹äº†åˆ†ç±»ç”¨ä¾‹çš„åŸºäºå“åº”çš„çŸ¥è¯†è’¸é¦â€”â€”**å…¶ä¸­å“åº”æ˜¯ç±»æ¦‚ç‡**ã€‚

    ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†åŸºäºå“åº”çš„çŸ¥è¯†è’¸é¦ç”¨äºå›å½’æ¨¡å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸºäºå›å½’çš„æŸå¤±å‡½æ•°ï¼Œä¾‹å¦‚å‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰ï¼Œè€Œä¸æ˜¯KLæ•£åº¦æŸå¤±å‡½æ•°ã€‚
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## å‰ªæ

    å‰ªæé€šå¸¸ç”¨äºåŸºäºæ ‘çš„æ¨¡å‹ï¼Œå…¶ä¸­å®ƒæ¶‰åŠç§»é™¤åˆ†æ”¯ï¼ˆæˆ–èŠ‚ç‚¹ï¼‰ä»¥ç®€åŒ–æ¨¡å‹ã€‚

    ![å†³ç­–æ ‘å‰ªæ](https://www.dailydoseofds.com/content/images/2023/09/image-69.png)

    å½“ç„¶ï¼Œåˆ é™¤èŠ‚ç‚¹ä¼šå¯¼è‡´æ¨¡å‹å‡†ç¡®æ€§çš„ä¸‹é™ã€‚

    å› æ­¤ï¼Œåœ¨å†³ç­–æ ‘çš„æƒ…å†µä¸‹ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯è¿­ä»£åœ°åˆ é™¤å­æ ‘ï¼Œåˆ é™¤åå¯¼è‡´ï¼š

    - åˆ†ç±»æˆæœ¬çš„æœ€å°å¢åŠ 
    - å¤æ‚æ€§ï¼ˆæˆ–èŠ‚ç‚¹ï¼‰çš„æœ€å¤§å‡å°‘

    ![å‰ªæå­æ ‘](https://www.dailydoseofds.com/content/images/2023/09/image-66.png)

    åœ¨ä¸Šé¢çš„å›¾åƒä¸­ï¼Œä¸¤ä¸ªå­æ ‘éƒ½å¯¼è‡´ç›¸åŒçš„æˆæœ¬å¢åŠ ã€‚ç„¶è€Œï¼Œåˆ é™¤å…·æœ‰æ›´å¤šèŠ‚ç‚¹çš„å­æ ‘ä»¥å‡å°‘è®¡ç®—å¤æ‚æ€§æ›´æœ‰æ„ä¹‰ã€‚

    åŒæ ·çš„æƒ³æ³•ä¹Ÿå¯ä»¥è½¬åŒ–ä¸ºç¥ç»ç½‘ç»œã€‚

    æ­£å¦‚æ‚¨å¯èƒ½çŒœåˆ°çš„ï¼Œç¥ç»ç½‘ç»œä¸­çš„å‰ªææ¶‰åŠè¯†åˆ«å’Œæ¶ˆé™¤å¯¹æ¨¡å‹æ•´ä½“æ€§èƒ½è´¡çŒ®æœ€å°çš„ç‰¹å®šè¿æ¥æˆ–ç¥ç»å…ƒã€‚

    ![ç¥ç»ç½‘ç»œå‰ªæ](https://www.dailydoseofds.com/content/images/2023/09/image-150.png)

    åˆ é™¤æ•´ä¸ªå±‚æ˜¯å¦ä¸€ä¸ªé€‰æ‹©ã€‚ä½†æˆ‘ä»¬å¾ˆå°‘å®è·µå®ƒï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´æƒé‡çŸ©é˜µä¸å¯¹é½ã€‚

    æ›´é‡è¦çš„æ˜¯ï¼Œé‡åŒ–ç‰¹å®šå±‚å¯¹æœ€ç»ˆè¾“å‡ºçš„è´¡çŒ®å¹¶ä¸å®¹æ˜“ã€‚

    å› æ­¤ï¼Œä¸å…¶åˆ é™¤è®­ç»ƒç½‘ç»œçš„å±‚ï¼Œä¸å¦‚é‡æ–°å®šä¹‰æ¶æ„è€Œä¸åŒ…å«æˆ‘ä»¬æ‰“ç®—åˆ é™¤çš„å±‚å¯èƒ½æ˜¯æ›´å¥½çš„æ–¹æ³•ã€‚

    **é€šè¿‡å‰ªæï¼Œç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªæ›´ç´§å‡‘çš„ç¥ç»ç½‘ç»œï¼ŒåŒæ—¶ä¿ç•™å°½å¯èƒ½å¤šçš„é¢„æµ‹èƒ½åŠ›ã€‚**

    è¿™ä¸»è¦é€šè¿‡ä¸¤ç§æ–¹å¼å®Œæˆï¼š

    - **ç¥ç»å…ƒå‰ªæï¼š**

    ![ç¥ç»å…ƒå‰ªæ](https://www.dailydoseofds.com/content/images/2023/09/image-72.png)

    - æƒ³æ³•æ˜¯ä»ç½‘ç»œä¸­æ¶ˆé™¤æ•´ä¸ª**èŠ‚ç‚¹**ã€‚
    - ç»“æœï¼Œè¡¨ç¤ºå±‚çš„çŸ©é˜µå˜å°ã€‚
    - è¿™å¯¼è‡´æ›´å¿«çš„æ¨ç†å’Œæ›´ä½çš„å†…å­˜ä½¿ç”¨ã€‚

    - **æƒé‡å‰ªæï¼š**

    ![æƒé‡å‰ªæ](https://www.dailydoseofds.com/content/images/2023/09/image-73.png)

    - è¿™æ¶‰åŠä»ç½‘ç»œä¸­æ¶ˆé™¤**è¾¹**ã€‚
    - æƒé‡å‰ªæå¯ä»¥è¢«è®¤ä¸ºæ˜¯åœ¨çŸ©é˜µä¸­æ”¾ç½®é›¶æ¥è¡¨ç¤ºè¢«ç§»é™¤çš„è¾¹ã€‚
    - ç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒçŸ©é˜µçš„å¤§å°ä¿æŒä¸å—å½±å“ã€‚
    - å› æ­¤ï¼ŒçŸ©é˜µçš„å¤§å°ä¿æŒç›¸åŒï¼Œä½†å®ƒä»¬å˜å¾—ç¨€ç–ã€‚
    - è™½ç„¶æ¶ˆé™¤è¾¹å¯èƒ½ä¸ä¸€å®šå¯¼è‡´æ›´å¿«çš„æ¨ç†ï¼Œä½†å®ƒç¡®å®æœ‰åŠ©äºä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚è¿™æ˜¯å› ä¸ºç¨€ç–çŸ©é˜µé€šå¸¸æ¯”å¯†é›†çŸ©é˜µå ç”¨æ›´å°‘çš„ç©ºé—´ã€‚

    é€šè¿‡ä»ç½‘ç»œä¸­åˆ é™¤ä¸é‡è¦çš„æƒé‡ï¼ˆæˆ–èŠ‚ç‚¹ï¼‰ï¼Œå¯ä»¥æœŸå¾…å‡ ä¸ªæ”¹è¿›ï¼š

    - æ›´å¥½çš„æ³›åŒ–
    - æ”¹è¿›çš„æ¨ç†é€Ÿåº¦
    - å‡å°‘çš„æ¨¡å‹å¤§å°

    ç„¶è€Œï¼Œå¤§é—®é¢˜æ˜¯ï¼š**æˆ‘ä»¬åº”è¯¥å‰ªæå“ªäº›æƒé‡å’Œç¥ç»å…ƒï¼Ÿ**

    æœ‰å‡ ç§æµè¡Œçš„æ–¹æ³•æ¥åœ¨ç¥ç»ç½‘ç»œä¸­å®ç°å‰ªæã€‚è®©æˆ‘ä»¬è®¨è®ºå®ƒä»¬ã€‚
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ### é›¶å‰ªæ

    è¿™æ˜¯å‰ªæç¥ç»ç½‘ç»œæœ€ç®€å•çš„æ–¹æ³•ä¹‹ä¸€ï¼Œæ— è®ºæ˜¯åœ¨ç†è§£è¿˜æ˜¯å®ç°æ–¹é¢ã€‚

    è¿™é‡Œï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯åŸºäºè¾¹æƒé‡çš„å¤§å°æ¥ç§»é™¤è¾¹ã€‚ç§»é™¤è¾¹æ„å‘³ç€å°†å…¶æƒé‡è®¾ç½®ä¸ºé›¶ã€‚

    ![é›¶å‰ªæ](https://www.dailydoseofds.com/content/images/2023/09/image-75.png)

    å¦‚æœè¾¹æƒé‡æ¥è¿‘é›¶ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯èƒ½å¯¹ç¥ç»å…ƒçš„æ¿€æ´»è´¡çŒ®å¾ˆä½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›è¾¹æƒé‡è®¾ç½®ä¸ºé›¶ã€‚

    å®ç°æ–¹é¢ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬åƒé€šå¸¸é‚£æ ·è®­ç»ƒç¥ç»ç½‘ç»œã€‚

    æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¾¹æƒé‡å®šä¹‰ä¸€ä¸ªé˜ˆå€¼ï¼ˆÎ»ï¼‰ï¼Œæ¯”å¦‚Î» = 0.02ã€‚

    æœ€åï¼Œæˆ‘ä»¬å°†æ‰€æœ‰ä½äºæŒ‡å®šé˜ˆå€¼çš„æƒé‡å½’é›¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
    """
    )
    return


@app.cell(hide_code=True)
def _(torch):
    # é›¶å‰ªæå®ç°
    def zero_pruning(model, threshold=0.02):
        """
        å¯¹æ¨¡å‹è¿›è¡Œé›¶å‰ªæ

        Args:
            model: è¦å‰ªæçš„æ¨¡å‹
            threshold: å‰ªæé˜ˆå€¼
        """
        total_params = 0
        pruned_params = 0

        with torch.no_grad():
            for name, param in model.named_parameters():
                if 'weight' in name:
                    total_params += param.numel()
                    # æ‰¾åˆ°å°äºé˜ˆå€¼çš„æƒé‡
                    mask = torch.abs(param) < threshold
                    pruned_params += mask.sum().item()
                    # å°†å°äºé˜ˆå€¼çš„æƒé‡è®¾ä¸ºé›¶
                    param[mask] = 0.0

        pruning_ratio = pruned_params / total_params * 100
        print(f"å‰ªææ¯”ä¾‹: {pruning_ratio:.2f}%")
        print(f"æ€»å‚æ•°: {total_params}, å‰ªæå‚æ•°: {pruned_params}")

        return pruning_ratio

    print("é›¶å‰ªæå‡½æ•°å®šä¹‰å®Œæˆ")
    return (zero_pruning,)


@app.cell(hide_code=True)
def _(
    StudentModel,
    device,
    evaluate_model,
    student_model,
    test_loader,
    zero_pruning,
):
    # åˆ›å»ºä¸€ä¸ªæ–°çš„å­¦ç”Ÿæ¨¡å‹å‰¯æœ¬è¿›è¡Œå‰ªææµ‹è¯•
    pruned_model = StudentModel()
    pruned_model.load_state_dict(student_model.state_dict())
    pruned_model.to(device)

    # è¯„ä¼°å‰ªæå‰çš„æ€§èƒ½
    accuracy_before = evaluate_model(pruned_model, test_loader)
    print(f"å‰ªæå‰å‡†ç¡®ç‡: {accuracy_before:.2f}%")

    # è¿›è¡Œé›¶å‰ªæ
    pruning_ratio = zero_pruning(pruned_model, threshold=0.02)

    # è¯„ä¼°å‰ªæåçš„æ€§èƒ½
    accuracy_after = evaluate_model(pruned_model, test_loader)
    print(f"å‰ªæåå‡†ç¡®ç‡: {accuracy_after:.2f}%")
    print(f"å‡†ç¡®ç‡å˜åŒ–: {accuracy_after - accuracy_before:.2f}%")
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ### æ¿€æ´»å‰ªæ

    ä¸ä»…ä¾èµ–åŸºäºé˜ˆå€¼çš„é›¶å‰ªæä¸åŒï¼Œç¥ç»å…ƒæ¿€æ´»ä¹Ÿå¯ä»¥ç”¨ä½œå‰ªæçš„æ ‡å‡†ã€‚

    æœ¬è´¨ä¸Šï¼Œå½“é€šè¿‡ç½‘ç»œè¿è¡Œæ•°æ®é›†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å’Œåˆ†æå„ä¸ªç¥ç»å…ƒæ¿€æ´»çš„æŸäº›ç»Ÿè®¡ä¿¡æ¯ã€‚

    ![è®¡ç®—ç¥ç»å…ƒæ¿€æ´»ç»Ÿè®¡](https://www.dailydoseofds.com/content/images/2023/09/image-152.png)

    åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯èƒ½è§‚å¯Ÿåˆ°ä¸€äº›ç¥ç»å…ƒæ€»æ˜¯è¾“å‡ºæ¥è¿‘é›¶çš„å€¼ã€‚

    ç»“æœï¼Œå®ƒä»¬å¾ˆå¯èƒ½è¢«ç§»é™¤ï¼Œå› ä¸ºå®ƒä»¬å¯¹æ¨¡å‹çš„è¾“å‡ºå½±å“å¾ˆå°ã€‚

    ![ç›¸ä¼¼çš„å¹³å‡æ¿€æ´»](https://www.dailydoseofds.com/content/images/2023/09/image-153.png)

    è¿™ä¹Ÿå¾ˆç›´è§‚â€”â€”å¦‚æœä¸€ä¸ªç¥ç»å…ƒå¾ˆå°‘å…·æœ‰é«˜æ¿€æ´»å€¼ï¼Œé‚£ä¹ˆå¯ä»¥åˆç†å‡è®¾å®ƒæ²¡æœ‰å¯¹æ¨¡å‹çš„è¾“å‡ºåšå‡ºè´¡çŒ®ã€‚

    ä»¥ä¸‹æ˜¯æˆ‘ä»¬éœ€è¦éµå¾ªçš„æ­¥éª¤æ¥å®ç°æ¿€æ´»å‰ªæï¼š

    - åƒé€šå¸¸é‚£æ ·è®­ç»ƒç¥ç»ç½‘ç»œã€‚
    - è®­ç»ƒåï¼Œå†æ¬¡é€šè¿‡ç½‘ç»œè¿è¡Œè®­ç»ƒæ•°æ®ï¼ˆä¸åå‘ä¼ æ’­æ¢¯åº¦ï¼‰ã€‚
    - è®¡ç®—éšè—å±‚ä¸­æ¯ä¸ªç¥ç»å…ƒåœ¨æ•´ä¸ªæ•°æ®ä¸Šçš„å¹³å‡æ¿€æ´»ã€‚
    - å®šä¹‰å‰ªæé˜ˆå€¼Î»ã€‚
    - æ ‡è®°æ¿€æ´»ä½äºå‰ªæé˜ˆå€¼Î»çš„ç¥ç»å…ƒã€‚
    - ä»è®­ç»ƒç½‘ç»œçš„æƒé‡çŸ©é˜µä¸­ç§»é™¤æ ‡è®°çš„ç¥ç»å…ƒã€‚
    - å®Œæˆï¼
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ### å†—ä½™å‰ªæ

    æœ‰æ—¶ï¼Œå¦‚æœå±‚ä¸­çš„ä¸¤ä¸ªç¥ç»å…ƒå…·æœ‰éå¸¸ç›¸ä¼¼çš„æ¿€æ´»ï¼Œè¿™å¯èƒ½æ„å‘³ç€å®ƒä»¬æ­£åœ¨æ•è·ç›¸åŒçš„ç‰¹å¾ã€‚

    æ ¹æ®è¿™ç§ç›´è§‰ï¼Œæˆ‘ä»¬å¯ä»¥ç§»é™¤å…¶ä¸­ä¸€ä¸ªç¥ç»å…ƒå¹¶ä¿æŒç›¸åŒçš„åŠŸèƒ½ã€‚

    ![å†—ä½™å‰ªæ](https://www.dailydoseofds.com/content/images/2023/09/image-154.png)

    è™½ç„¶è¿™å¬èµ·æ¥å¾ˆç›´è§‚ï¼Œä½†è¿™å®ç°èµ·æ¥æœ‰ç‚¹å¤æ‚ã€‚

    æ­¤å¤–ï¼Œå†—ä½™å‰ªææœ‰æ—¶å¯èƒ½æ˜¯å‰ªæç¥ç»ç½‘ç»œçš„**æœ‰ç‚¹ä¸å¯é **çš„æ–¹æ³•ã€‚ä½ èƒ½å›ç­”ä¸ºä»€ä¹ˆå—ï¼Ÿè¿™æ˜¯ç»™ä½ çš„ç»ƒä¹ ã€‚

    å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘è®¤ä¸ºäº†è§£æ–‡çŒ®ä¸­æå‡ºçš„å¸¸è§æŠ€æœ¯ä»ç„¶æ˜¯æœ‰ç”¨çš„ã€‚
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## ä½ç§©åˆ†è§£

    åœ¨å…¶æ ¸å¿ƒï¼Œä½ç§©åˆ†è§£æ—¨åœ¨ä½¿ç”¨è¾ƒä½ç§©çš„çŸ©é˜µæ¥è¿‘ä¼¼ç¥ç»ç½‘ç»œçš„æƒé‡çŸ©é˜µã€‚

    æœ¬è´¨ä¸Šï¼Œæƒ³æ³•æ˜¯å°†å¤æ‚çš„æƒé‡çŸ©é˜µè¡¨ç¤ºä¸ºä¸¤ä¸ªæˆ–æ›´å¤šç®€å•çŸ©é˜µçš„ä¹˜ç§¯ã€‚

    ![çŸ©é˜µåˆ†è§£ä¸ºæ›´å°çš„çŸ©é˜µ](https://www.dailydoseofds.com/content/images/2023/09/image-155.png)

    å¦‚æœæˆ‘ä»¬ç†è§£è¿™äº›ä¸ªåˆ«æœ¯è¯­ï¼Œæƒ³æ³•ä¼šå˜å¾—æ›´æ¸…æ¥šï¼š

    - **ä½ç§©ï¼š**
        - åœ¨çº¿æ€§ä»£æ•°ä¸­ï¼ŒçŸ©é˜µçš„"ç§©"æŒ‡çš„æ˜¯è¯¥çŸ©é˜µä¸­çº¿æ€§æ— å…³è¡Œï¼ˆæˆ–åˆ—ï¼‰çš„æœ€å¤§æ•°é‡ã€‚
        - å› æ­¤ï¼Œä½ç§©çŸ©é˜µå…·æœ‰è¾ƒå°‘çš„çº¿æ€§æ— å…³è¡Œæˆ–åˆ—ã€‚
        - è¿™æ„å‘³ç€å®ƒå¯ä»¥è¿‘ä¼¼ä¸ºè¾ƒå°‘æ•°é‡çš„åŸºå‘é‡çš„ç»„åˆï¼Œå¸®åŠ©æˆ‘ä»¬å‡å°‘ç»´åº¦ã€‚
    - **åˆ†è§£**
        - åœ¨æ•°å­¦ä¸­ï¼Œ"åˆ†è§£"æ„å‘³ç€å°†å¤æ‚çš„æ•°å­¦å¯¹è±¡ï¼ˆå¦‚çŸ©é˜µï¼‰è¡¨è¾¾ä¸ºæ›´ç®€å•æ•°å­¦å¯¹è±¡çš„ä¹˜ç§¯ã€‚

    å› æ­¤ï¼Œ**ä½ç§©åˆ†è§£**æ„å‘³ç€å°†ç»™å®šçš„æƒé‡çŸ©é˜µåˆ†è§£ä¸ºä¸¤ä¸ªæˆ–æ›´å¤šè¾ƒä½ç»´åº¦çŸ©é˜µçš„ä¹˜ç§¯ã€‚

    è¿™äº›è¾ƒä½ç»´åº¦çš„çŸ©é˜µé€šå¸¸è¢«ç§°ä¸º"å› å­çŸ©é˜µ"æˆ–"åŸºçŸ©é˜µ"ã€‚

    è®©æˆ‘ä»¬äº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

    ### æ­¥éª¤1ï¼‰æ‰§è¡ŒçŸ©é˜µåˆ†è§£

    åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œæ¯ä¸€å±‚éƒ½æœ‰ä¸€ä¸ªæƒé‡çŸ©é˜µã€‚

    æˆ‘ä»¬å¯ä»¥å°†è¿™äº›åŸå§‹æƒé‡çŸ©é˜µåˆ†è§£ä¸ºä½ç§©è¿‘ä¼¼ã€‚

    æœ‰è®¸å¤šä¸åŒçš„çŸ©é˜µåˆ†è§£æ–¹æ³•å¯ç”¨ï¼Œå¦‚å¥‡å¼‚å€¼åˆ†è§£ï¼ˆSVDï¼‰ã€éè´ŸçŸ©é˜µåˆ†è§£ï¼ˆNMFï¼‰æˆ–æˆªæ–­SVDã€‚

    ### æ­¥éª¤2ï¼‰æŒ‡å®šç§©

    åœ¨çŸ©é˜µåˆ†è§£ä¸­ï¼Œæ‚¨é€šå¸¸å¿…é¡»ä¸ºä½ç§©è¿‘ä¼¼é€‰æ‹©ç§©`k`ã€‚

    å®ƒç¡®å®šå¥‡å¼‚å€¼çš„æ•°é‡ï¼ˆå¯¹äºSVDï¼‰æˆ–å› å­çš„æ•°é‡ï¼ˆå¯¹äºåˆ†è§£æ–¹æ³•ï¼‰ã€‚

    ![æŒ‡å®šç§©](https://www.dailydoseofds.com/content/images/2023/09/image-156.png)

    ç§©`k`çš„é€‰æ‹©ç›´æ¥ä¸æ¨¡å‹å¤§å°å‡å°‘å’Œä¿¡æ¯ä¿å­˜ä¹‹é—´çš„æƒè¡¡ç›¸å…³ã€‚

    ### æ­¥éª¤3ï¼‰é‡æ„æƒé‡çŸ©é˜µ

    ä¸€æ—¦æ‚¨è·å¾—äº†ä½ç§©çŸ©é˜µï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥è½¬æ¢è¾“å…¥ï¼Œè€Œä¸æ˜¯åŸå§‹æƒé‡çŸ©é˜µã€‚

    ![é‡æ„æƒé‡çŸ©é˜µ](https://www.dailydoseofds.com/content/images/2023/09/image-157.png)

    è¿™æ ·åšçš„å¥½å¤„æ˜¯å®ƒå‡å°‘äº†ç¥ç»ç½‘ç»œçš„è®¡ç®—å¤æ‚æ€§ï¼ŒåŒæ—¶ä¿ç•™äº†è®­ç»ƒæœŸé—´å­¦ä¹ çš„é‡è¦ç‰¹å¾ã€‚

    é€šè¿‡ç”¨å®ƒä»¬çš„ä½ç§©è¿‘ä¼¼æ›¿æ¢åŸå§‹æƒé‡çŸ©é˜µï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘æ¨¡å‹ä¸­çš„å‚æ•°æ•°é‡ï¼Œä»è€Œå‡å°‘å…¶å¤§å°ã€‚

    **è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå®é™…æ“ä½œï¼**

    æˆ‘ä»¬å°†ä½¿ç”¨å¥‡å¼‚å€¼åˆ†è§£ï¼ˆSVDï¼‰å°†æƒé‡çŸ©é˜µåˆ†è§£ä¸ºä½ç§©çŸ©é˜µã€‚
    """
    )
    return


@app.cell
def _(torch):
    # ä½ç§©åˆ†è§£å®ç°
    def low_rank_factorization(weight_matrix, rank):
        """
        ä½¿ç”¨SVDå¯¹æƒé‡çŸ©é˜µè¿›è¡Œä½ç§©åˆ†è§£

        Args:
            weight_matrix: è¦åˆ†è§£çš„æƒé‡çŸ©é˜µ
            rank: ç›®æ ‡ç§©

        Returns:
            U, S, V: åˆ†è§£åçš„çŸ©é˜µ
        """
        # æ‰§è¡ŒSVDåˆ†è§£
        U, S, V = torch.svd(weight_matrix)

        # æˆªæ–­åˆ°æŒ‡å®šçš„ç§©
        U_low_rank = U[:, :rank]
        S_low_rank = torch.diag(S[:rank])
        V_low_rank = V[:, :rank]

        return U_low_rank, S_low_rank, V_low_rank

    def compute_operations(original_shape, rank):
        """
        è®¡ç®—åŸå§‹çŸ©é˜µå’Œåˆ†è§£çŸ©é˜µçš„æ“ä½œæ•°

        Args:
            original_shape: åŸå§‹çŸ©é˜µå½¢çŠ¶ (m, n)
            rank: åˆ†è§£åçš„ç§©

        Returns:
            original_ops, factorized_ops: æ“ä½œæ•°
        """
        m, n = original_shape
        batch_size = 32  # å‡è®¾æ‰¹æ¬¡å¤§å°

        # åŸå§‹çŸ©é˜µæ“ä½œæ•°: batch_size * m * n
        original_ops = batch_size * m * n

        # åˆ†è§£çŸ©é˜µæ“ä½œæ•°: batch_size * (m * rank + rank * rank + rank * n)
        factorized_ops = batch_size * (m * rank + rank * rank + rank * n)

        return original_ops, factorized_ops

    print("ä½ç§©åˆ†è§£å‡½æ•°å®šä¹‰å®Œæˆ")
    return compute_operations, low_rank_factorization


@app.cell
def _(compute_operations, low_rank_factorization, student_model):
    # æ¼”ç¤ºä½ç§©åˆ†è§£
    # è·å–å­¦ç”Ÿæ¨¡å‹çš„ç¬¬ä¸€ä¸ªçº¿æ€§å±‚æƒé‡
    fc1_weight = student_model.fc1.weight.data
    print(f"åŸå§‹æƒé‡çŸ©é˜µå½¢çŠ¶: {fc1_weight.shape}")

    # é€‰æ‹©ä¸åŒçš„ç§©è¿›è¡Œåˆ†è§£
    ranks = [32, 64, 96]

    for rank in ranks:
        # æ‰§è¡Œä½ç§©åˆ†è§£
        U, S, V = low_rank_factorization(fc1_weight, rank)

        print(f"\nç§© {rank} çš„åˆ†è§£ç»“æœ:")
        print(f"U å½¢çŠ¶: {U.shape}")
        print(f"S å½¢çŠ¶: {S.shape}")
        print(f"V å½¢çŠ¶: {V.shape}")

        # è®¡ç®—å‚æ•°æ•°é‡
        original_params = fc1_weight.numel()
        factorized_params = U.numel() + S.numel() + V.numel()

        print(f"åŸå§‹å‚æ•°æ•°é‡: {original_params}")
        print(f"åˆ†è§£åå‚æ•°æ•°é‡: {factorized_params}")
        print(f"å‚æ•°å‡å°‘: {(1 - factorized_params/original_params)*100:.2f}%")

        # è®¡ç®—æ“ä½œæ•°
        original_ops, factorized_ops = compute_operations(fc1_weight.shape, rank)
        print(f"åŸå§‹æ“ä½œæ•°: {original_ops}")
        print(f"åˆ†è§£åæ“ä½œæ•°: {factorized_ops}")
        print(f"æ“ä½œå‡å°‘: {(1 - factorized_ops/original_ops)*100:.2f}%")
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## é‡åŒ–

    æœ€åï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦ä¸€ç§ç›´è§‚ä¸”æœ‰ç”¨çš„æŠ€æœ¯æ¥å‡å°‘æ¨¡å‹çš„å¤§å°ã€‚

    ### åŠ¨æœº

    é€šå¸¸ï¼Œç¥ç»ç½‘ç»œçš„å‚æ•°ï¼ˆå±‚æƒé‡ï¼‰ä½¿ç”¨32ä½æµ®ç‚¹æ•°è¡¨ç¤ºã€‚è¿™å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒæä¾›äº†é«˜ç²¾åº¦æ°´å¹³ã€‚

    æ­¤å¤–ï¼Œç”±äºå‚æ•°é€šå¸¸ä¸å—ä»»ä½•ç‰¹å®šå€¼èŒƒå›´çš„çº¦æŸï¼Œæ‰€æœ‰æ·±åº¦å­¦ä¹ æ¡†æ¶é»˜è®¤ä¸ºå‚æ•°åˆ†é…æœ€å¤§çš„æ•°æ®ç±»å‹ã€‚

    ä½†ä½¿ç”¨æœ€å¤§çš„æ•°æ®ç±»å‹ä¹Ÿæ„å‘³ç€æ¶ˆè€—æ›´å¤šå†…å­˜ã€‚

    æ­£å¦‚æ‚¨å¯èƒ½çŒœåˆ°çš„ï¼Œé‡åŒ–æ¶‰åŠä½¿ç”¨è¾ƒä½ä½è¡¨ç¤ºï¼Œå¦‚16ä½ã€8ä½ã€4ä½ï¼Œç”šè‡³1ä½æ¥è¡¨ç¤ºå‚æ•°ã€‚

    ![é‡åŒ–](https://www.dailydoseofds.com/content/images/2023/09/image-158.png)

    è¿™å¯¼è‡´å­˜å‚¨æ¨¡å‹å‚æ•°æ‰€éœ€çš„å†…å­˜é‡æ˜¾è‘—å‡å°‘ã€‚

    ä¾‹å¦‚ï¼Œè€ƒè™‘æ‚¨çš„æ¨¡å‹æœ‰è¶…è¿‡ä¸€ç™¾ä¸‡ä¸ªå‚æ•°ï¼Œæ¯ä¸ªéƒ½ç”¨32ä½æµ®ç‚¹æ•°è¡¨ç¤ºã€‚

    å¦‚æœå¯èƒ½ï¼Œç”¨8ä½æ•°å­—è¡¨ç¤ºå®ƒä»¬å¯ä»¥å¯¼è‡´å†…å­˜ä½¿ç”¨çš„æ˜¾è‘—å‡å°‘ï¼ˆçº¦75%ï¼‰ï¼ŒåŒæ—¶ä»ç„¶å…è®¸è¡¨ç¤ºå¤§èŒƒå›´çš„å€¼ã€‚

    å½“ç„¶ï¼Œé‡åŒ–åœ¨æ¨¡å‹å¤§å°å’Œç²¾åº¦ä¹‹é—´å¼•å…¥äº†æƒè¡¡ã€‚

    è™½ç„¶å‡å°‘å‚æ•°çš„ä½å®½ä½¿æ¨¡å‹æ›´å°ï¼Œä½†å®ƒä¹Ÿå¯¼è‡´ç²¾åº¦æŸå¤±ã€‚

    è¿™æ„å‘³ç€æ¨¡å‹çš„é¢„æµ‹å˜å¾—æ¯”åŸå§‹çš„å…¨ç²¾åº¦æ¨¡å‹æ›´è¿‘ä¼¼ã€‚

    å› æ­¤ï¼Œåœ¨è€ƒè™‘éƒ¨ç½²é‡åŒ–æ—¶ï¼Œä»”ç»†è¯„ä¼°æ¨¡å‹å¤§å°/æ¨ç†é€Ÿåº¦å’Œå‡†ç¡®æ€§ä¹‹é—´çš„æƒè¡¡æ˜¯é‡è¦çš„ã€‚

    å°½ç®¡æœ‰è¿™ç§æƒè¡¡ï¼Œé‡åŒ–åœ¨æ¨¡å‹å¤§å°æ˜¯å…³é”®çº¦æŸçš„åœºæ™¯ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œå¦‚è¾¹ç¼˜è®¾å¤‡ã€ç§»åŠ¨åº”ç”¨ç¨‹åºæˆ–æ™ºèƒ½æ‰‹æœºç­‰ä¸“ç”¨ç¡¬ä»¶ã€‚

    é‡åŒ–å®é™…ä½¿ç”¨çš„æœ€å¸¸è§æ–¹å¼ä¹‹ä¸€ç§°ä¸º**è®­ç»ƒåé‡åŒ–**ã€‚

    ### è®­ç»ƒåé‡åŒ–

    é¡¾åæ€ä¹‰ï¼Œè¿™æ¶‰åŠä½¿ç”¨è¾ƒä½ç²¾åº¦çš„æµ®ç‚¹æ•°æ¥è¡¨ç¤ºè®­ç»ƒæ¨¡å‹çš„æƒé‡ã€‚

    æ‰€ä»¥é¦–å…ˆï¼Œæˆ‘ä»¬åƒé€šå¸¸é‚£æ ·è®­ç»ƒæ¨¡å‹ã€‚

    æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ”¹å˜æ¨¡å‹å‚æ•°çš„æ•°æ®ç±»å‹ã€‚

    è¿™æ˜¯é€šè¿‡åœ¨ä»£è¡¨æ€§æ•°æ®é›†ä¸Šè¯„ä¼°æ¨¡å‹çš„æƒé‡å’Œæ¿€æ´»å¹¶ç¡®å®šè¡¨ç¤ºå®ƒä»¬çš„æœ€åˆé€‚ç²¾åº¦æ¥å®Œæˆçš„ã€‚
    """
    )
    return


@app.cell
def _(StudentModel, device, student_model, torch):
    # è®­ç»ƒåé‡åŒ–å®ç°
    def post_training_quantization(model):
        """
        å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒåé‡åŒ–

        Args:
            model: è¦é‡åŒ–çš„æ¨¡å‹

        Returns:
            quantized_model: é‡åŒ–åçš„æ¨¡å‹
        """
        # è®¾ç½®é‡åŒ–é…ç½®
        model.eval()

        # ä½¿ç”¨PyTorchçš„åŠ¨æ€é‡åŒ–
        quantized_model = torch.quantization.quantize_dynamic(
            model,
            {torch.nn.Linear},  # é‡åŒ–çº¿æ€§å±‚
            dtype=torch.qint8   # ä½¿ç”¨8ä½æ•´æ•°
        )

        return quantized_model

    def get_model_size(model):
        """
        è®¡ç®—æ¨¡å‹å¤§å°ï¼ˆä»¥MBä¸ºå•ä½ï¼‰

        Args:
            model: æ¨¡å‹

        Returns:
            size_mb: æ¨¡å‹å¤§å°ï¼ˆMBï¼‰
        """
        param_size = 0
        buffer_size = 0

        for param in model.parameters():
            param_size += param.nelement() * param.element_size()

        for buffer in model.buffers():
            buffer_size += buffer.nelement() * buffer.element_size()

        size_mb = (param_size + buffer_size) / 1024 / 1024
        return size_mb

    # åˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å‹å‰¯æœ¬è¿›è¡Œé‡åŒ–
    quantization_model = StudentModel()
    quantization_model.load_state_dict(student_model.state_dict())
    quantization_model.to(device)

    # è®¡ç®—åŸå§‹æ¨¡å‹å¤§å°
    original_size = get_model_size(quantization_model)
    print(f"åŸå§‹æ¨¡å‹å¤§å°: {original_size:.2f} MB")

    # æ‰§è¡Œé‡åŒ–
    quantized_model = post_training_quantization(quantization_model)

    # è®¡ç®—é‡åŒ–åæ¨¡å‹å¤§å°
    quantized_size = get_model_size(quantized_model)
    print(f"é‡åŒ–åæ¨¡å‹å¤§å°: {quantized_size:.2f} MB")
    print(f"å¤§å°å‡å°‘: {(1 - quantized_size/original_size)*100:.2f}%")
    return quantization_model, quantized_model


@app.cell
def _(evaluate_model, quantization_model, quantized_model, test_loader, torch):
    # è¯„ä¼°é‡åŒ–æ¨¡å‹æ€§èƒ½
    def evaluate_quantized_model(model, test_loader):
        """
        è¯„ä¼°é‡åŒ–æ¨¡å‹
        """
        model.eval()
        correct = 0
        total = 0

        with torch.no_grad():
            for data, target in test_loader:
                # é‡åŒ–æ¨¡å‹åœ¨CPUä¸Šè¿è¡Œ
                data, target = data.cpu(), target.cpu()
                output = model(data)
                _, predicted = torch.max(output.data, 1)
                total += target.size(0)
                correct += (predicted == target).sum().item()

        accuracy = 100 * correct / total
        return accuracy

    # è¯„ä¼°é‡åŒ–æ¨¡å‹
    quantized_accuracy = evaluate_quantized_model(quantized_model, test_loader)
    print(f"é‡åŒ–æ¨¡å‹å‡†ç¡®ç‡: {quantized_accuracy:.2f}%")

    # ä¸åŸå§‹æ¨¡å‹æ¯”è¾ƒ
    original_accuracy = evaluate_model(quantization_model, test_loader)
    print(f"åŸå§‹æ¨¡å‹å‡†ç¡®ç‡: {original_accuracy:.2f}%")
    print(f"å‡†ç¡®ç‡å˜åŒ–: {quantized_accuracy - original_accuracy:.2f}%")
    return original_accuracy, quantized_accuracy


@app.cell
def _(mo, original_accuracy, quantized_accuracy):
    mo.md(
        f"""
    ### é‡åŒ–ç»“æœåˆ†æ

    å¦‚ä¸Šæ‰€ç¤ºï¼š

    - ä¸¤ä¸ªæ¨¡å‹éƒ½è¾¾åˆ°äº†ç›¸åŒçš„æµ‹è¯•å‡†ç¡®ç‡ï¼ˆåŸå§‹æ¨¡å‹ï¼š{original_accuracy:.2f}%ï¼Œé‡åŒ–æ¨¡å‹ï¼š{quantized_accuracy:.2f}%ï¼‰ã€‚
    - ç„¶è€Œï¼Œé‡åŒ–æ¨¡å‹æ›´å°ï¼Œå› ä¸ºå®ƒä½¿ç”¨è¾ƒå°çš„æ•°æ®ç±»å‹æ¥è¡¨ç¤ºå‚æ•°ã€‚

    ğŸ’¡ **é‡è¦æç¤º**

    è™½ç„¶åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‡†ç¡®ç‡æ˜¯ç›¸åŒçš„ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ„å‘³ç€é‡åŒ–æ¨¡å‹æ€»æ˜¯ä¼šè¡¨ç°å¾—åƒæœªé‡åŒ–ï¼ˆæˆ–æ­£å¸¸ï¼‰æ¨¡å‹ä¸€æ ·å¥½ã€‚é‡è¦çš„æ˜¯è¦åœ¨ä¸€ç³»åˆ—æ•°æ®ç±»å‹ä¸Šè¯„ä¼°é‡åŒ–æ¨¡å‹ï¼Œå¹¶ä¸»è§‚åœ°å†³å®šæœ€ä½³æ¨¡å‹ï¼Œå°±åƒæˆ‘ä»¬ä¹‹å‰åœ¨é›¶å‰ªæã€æ¿€æ´»å‰ªæå’Œä½ç§©åˆ†è§£ä¸­æ‰€åšçš„é‚£æ ·ã€‚
    """
    )
    return


@app.cell(hide_code=True)
def _(mo):
    mo.md(
        r"""
    ## ç»“è®º

    è‡³æ­¤ï¼Œæˆ‘ä»¬ç»“æŸäº†è¿™ç¯‡æ–‡ç« ã€‚

    åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å‡ ç§æ¨¡å‹å‹ç¼©æŠ€æœ¯ï¼Œè¿™äº›æŠ€æœ¯å¯¹ä»¥ä¸‹æ–¹é¢å¾ˆæœ‰ç”¨ï¼š

    1. åŠ é€Ÿæ¨¡å‹æ¨ç†é˜¶æ®µ
    2. å‡å°‘æ¨¡å‹çš„å¤§å°

    ä¸Šè¿°ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²çš„æ¨¡å‹çš„å…³é”®è¦æ±‚ã€‚

    ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬è®¨è®ºäº†ï¼š

    - **çŸ¥è¯†è’¸é¦**ï¼šè®­ç»ƒä¸€ä¸ªå¤§æ¨¡å‹ï¼ˆæ•™å¸ˆï¼‰å¹¶å°†å…¶çŸ¥è¯†è½¬ç§»åˆ°ä¸€ä¸ªè¾ƒå°çš„æ¨¡å‹ï¼ˆå­¦ç”Ÿï¼‰ã€‚
    - **å‰ªæ**ï¼šä»ç½‘ç»œä¸­ç§»é™¤ä¸ç›¸å…³çš„è¾¹å’ŒèŠ‚ç‚¹ã€‚
        - é›¶å‰ªæ
        - æ¿€æ´»å‰ªæ
        - å†—ä½™å‰ªæ
    - **ä½ç§©åˆ†è§£**ï¼šå°†æƒé‡çŸ©é˜µåˆ†è§£ä¸ºè¾ƒå°çš„"ä½ç§©"çŸ©é˜µã€‚
    - **é‡åŒ–**ï¼šä½¿ç”¨è¾ƒä½ä½è¡¨ç¤ºæ¥å­˜å‚¨å‚æ•°ä»¥å‡å°‘æ¨¡å‹çš„å†…å­˜ä½¿ç”¨ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„å¤§è¡¨ç¤ºã€‚

    æˆ‘ä»¬è¿˜è®¨è®ºäº†å®ƒä»¬åœ¨Pythonä¸­çš„å®ç°ã€‚

    æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æœ¬æ–‡çš„ä»£ç ï¼š

    [æ¨¡å‹å‹ç¼©æ–‡ç« ä»£ç ](https://www.dailydoseofds.com/content/files/2023/09/Model-Compression-Article-2.ipynb)

    äº†è§£è¿™äº›æŠ€æœ¯å¯¹äºåœ¨èµ„æºæœ‰é™çš„è®¾å¤‡ä¸Šéƒ¨ç½²MLæ¨¡å‹ä¹Ÿéå¸¸æœ‰å¸®åŠ©â€”â€”ä¾‹å¦‚æ™ºèƒ½æ‰‹æœºå’ŒAmazon Alexaã€‚

    ### å…³é”®è¦ç‚¹

    1. **æ¨¡å‹å‹ç¼©æ˜¯ç”Ÿäº§éƒ¨ç½²çš„å¿…éœ€å“**ï¼šåœ¨ç°å®ä¸–ç•Œåº”ç”¨ä¸­ï¼Œæ¨¡å‹çš„æ•ˆç‡å¾€å¾€æ¯”çº¯ç²¹çš„å‡†ç¡®æ€§æ›´é‡è¦ã€‚

    2. **æƒè¡¡æ˜¯ä¸å¯é¿å…çš„**ï¼šæ‰€æœ‰å‹ç¼©æŠ€æœ¯éƒ½æ¶‰åŠåœ¨æ¨¡å‹å¤§å°/é€Ÿåº¦å’Œå‡†ç¡®æ€§ä¹‹é—´çš„æƒè¡¡ã€‚å…³é”®æ˜¯æ‰¾åˆ°é€‚åˆæ‚¨ç‰¹å®šç”¨ä¾‹çš„å¹³è¡¡ç‚¹ã€‚

    3. **ç»„åˆæŠ€æœ¯å¯èƒ½æ›´æœ‰æ•ˆ**ï¼šæ‚¨å¯ä»¥ç»„åˆå¤šç§å‹ç¼©æŠ€æœ¯ï¼ˆä¾‹å¦‚ï¼ŒçŸ¥è¯†è’¸é¦ + å‰ªæ + é‡åŒ–ï¼‰ä»¥è·å¾—æ›´å¥½çš„ç»“æœã€‚

    4. **è¯„ä¼°æ˜¯å…³é”®**ï¼šå§‹ç»ˆåœ¨æ‚¨çš„ç‰¹å®šæ•°æ®é›†å’Œç”¨ä¾‹ä¸Šè¯„ä¼°å‹ç¼©æ¨¡å‹ï¼Œå› ä¸ºç»“æœå¯èƒ½å› åº”ç”¨è€Œå¼‚ã€‚

    5. **ç¡¬ä»¶è€ƒè™‘**ï¼šä¸åŒçš„å‹ç¼©æŠ€æœ¯åœ¨ä¸åŒçš„ç¡¬ä»¶ä¸Šå¯èƒ½æœ‰ä¸åŒçš„æ•ˆæœã€‚ä¾‹å¦‚ï¼Œé‡åŒ–åœ¨æŸäº›ä¸“ç”¨ç¡¬ä»¶ä¸Šå¯èƒ½ç‰¹åˆ«æœ‰æ•ˆã€‚

    é€šè¿‡æŒæ¡è¿™äº›æ¨¡å‹å‹ç¼©æŠ€æœ¯ï¼Œæ‚¨å°†èƒ½å¤Ÿæ„å»ºæ—¢é«˜æ€§èƒ½åˆé«˜æ•ˆçš„æœºå™¨å­¦ä¹ ç³»ç»Ÿï¼Œé€‚åˆåœ¨å„ç§ç¯å¢ƒä¸­éƒ¨ç½²ã€‚
    """
    )
    return


if __name__ == "__main__":
    app.run()
